/**
 * Scans page for timestamps and format them as relative-dynamic dates.
 *
 * @package   mod_treasurehunt
 * @copyright 2018 Juan Pablo de Castro <jpdecastro@tel.uva.es>
 * @author Juan Pablo de Castro <jpdecastro@tel.uva.es>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define(["jquery","core/str"],(function(t,e){var n=[];return{init:function(r,s=200,i=4,a=6e4){var o=["now","month","months","day","days","hour","hours","minute","minutes"].map((t=>({key:t,component:"core"})));o.push({key:"strftimedatetime",component:"core_langconfig"});var h=[];e.get_strings(o).then((e=>{e.forEach((t=>{h.push(t)})),Promise.all(h).then((e=>{var h=0;e.forEach((t=>{n[o[h++].key]=t})),setInterval((()=>{t(r).each(((e,n)=>{var r=n.dataset.timestamp,a=n.dataset.endtime;this.get_nice_date(r,s,i,a).then((e=>{t(n).text()!=e&&t(n).fadeOut("slow",(()=>{t(n).text(e).fadeIn()}))}))}))}),a)}))}))},get_nice_date:async function(t,e=200,n=4,r=null){var s;null===r&&(r=Date.now()/1e3);var i=r-t,a=(new Date,new Date(1e3*t));r>t?s="timeago":(s="timetocome",i=-i);var o=this.get_nice_duration(i).then((t=>({shortduration:t,date:a.toLocaleString()})));return i<120?x=this.get_string("now"):i>=0&&i<3600*n*24&&i<3600*e*24?x=this.get_string(s,"treasurehunt",o):i<3600*e*24?(o.shortduration=this.get_nice_duration(i,!0,!0),x=this.get_string(s+"long","treasurehunt",o)):x=this.get_string("timeat","treasurehunt",o),x},get_string:async function(t,r,s){return t in n?Promise.resolve(n[t]):s.then((n=>e.get_string(t,r,n)))},get_nice_duration:async function(t,e=!0,n=!1){var r,s=[],i=!1;e&&(t-=2592e3*(r=Math.floor(t/2592e3)));var a=Math.floor(t/86400);t-=3600*a*24;var o=Math.floor(t/3600);t-=3600*o;var h=Math.floor(t/60),u=Math.round(t-60*h);return e&&r>0&&(s.push(this.get_string("month"+(r>1?"s":"")).then((t=>r+" "+t))),o=0,h=0,u=0,n&&(i=!0)),a>0&&!1===i&&(s.push(this.get_string("day"+(a>1?"s":"")).then((t=>" "+a+" "+t))),h=0,u=0,n&&(i=!0)),o>0&&!1===i&&(s.push(this.get_string("hour"+(o>1?"s":"")).then((t=>" "+o+" "+t))),u=!1,n&&(i=!0)),h>0&&!1===i&&(s.push(this.get_string("minute"+(h>1?"s":"")).then((t=>" "+h+" "+t))),n&&(i=!0)),u>0&&!1===i&&s.push(" "+u+" s."),0===s.length&&s.push("-"),Promise.all(s).then((t=>t.join("")))}}}));