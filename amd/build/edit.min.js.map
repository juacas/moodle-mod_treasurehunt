{"version":3,"sources":["../src/edit.js"],"names":["define","$","jqui","touch","notification","ol","ajax","GeocoderJS","olLayerSwitcher","str","initedittreasurehunt","idModule","treasurehuntid","strings","selectedroadid","lockid","custommapconfig","mapprojobj","proj","Projection","custombaselayer","geographictools","custombackgroundurl","customimageextent","transformExtent","bbox","geographic","bboxwidth","bboxheight","centerwidth","centerheight","ratiorealmap","Math","round","imgheight","adjwidth","imgwidth","adjheight","layer","Image","title","layername","type","layertype","source","ImageStatic","url","imageExtent","opacity","wmsurl","options","TileWMS","params","wmsparams","customwmsextent","extent","Tile","treasurehunt","dirtyStages","Vector","projection","originalStages","dirty","abortDrawing","drawStarted","stageposition","roadid","stageid","selectedFeatures","selectedstageFeatures","idNewFeature","vectorSelected","openStreetMapGeocoder","createGeocoder","addClass","appendTo","attr","text","prependTo","button","icons","primary","buttonset","disabled","removeClass","sortable","handle","tolerance","zIndex","forcePlaceholderSize","cursorAt","top","cursor","axis","items","helper","start","event","ui","item","start_pos","index","scrollParent","data","maxScrollTop","scrollHeight","clientHeight","height","sort","scrollTop","update","end_pos","$listitems","children","$listlength","length","i","relocatestageList","roads","vector","activateSaveButton","disableSelection","newVal","$item","get","abs","find","hasClass","relocatenostage","parseInt","window","app","generateResizableControl","opt_options","document","createElement","element","innerHTML","id","className","appendChild","control","Control","call","target","inherits","defaultstageStyle","style","Style","fill","Fill","color","stroke","Stroke","width","image","Circle","radius","Text","textAlign","scale","selectedstageStyle","vectorDraw","visible","basemaps","Group","layers","BingMaps","key","imagerySet","maxZoom","OSM","onlybase","getLayers","clear","push","container","getElementById","content","closer","overlay","Overlay","autoPan","autoPanAnimation","duration","onclick","setPosition","blur","layerSwitcher","LayerSwitcher","map","Map","overlays","renderer","view","View","center","zoom","minZoom","controls","defaults","extend","showpopup","evt","coordinate","latlon","toLonLat","getView","getProjection","hdms","toStringHDMS","pegman","on","Draw","getActive","Modify","showPanel","resizable","handles","resize","size","originalSize","stop","updateSize","cancel","init","select","interaction","Select","filter","feature","getId","styles","addInteraction","modify","features","getFeatures","deleteCondition","events","condition","shiftKeyOnly","singleClick","setEvents","deactivateDeleteButton","getLength","activateDeleteButton","e","modifyFeatureToDirtySource","setActive","active","Polygon","getSource","setProperties","setId","addFeature","addNewFeatureToDirtySource","getTargetElement","keyup","keyCode","finishDrawing","deactivateEdition","snap","Snap","geojson","methodname","args","done","response","hide","status","code","alert","msg","geoJSONFeatures","stages","geoJSON","format","GeoJSON","Array","isArray","Object","values","forEach","road","blocked","addroad2ListPanel","name","readFeatures","dataProjection","featureProjection","addFeatures","updateWhileAnimating","styleFunction","getGeometry","setGeometry","geom","MultiPolygon","polygons","getPolygons","idNewFeatures","clue","newFeature","Feature","getProperties","polygon","idFeaturesPolygons","addstage2ListPanel","emptystage","addLayer","sortList","deactivateAddstage","activateAddstage","selectRoad","selectfirstroad","fail","error","console","log","exception","dirtyFeature","dirtySource","getFeatureById","clone","notEmptystage","appendPolygon","dirtyFeatures","multipolygon","split","j","removefeatureToDirtySource","remove","splice","join","isNaN","getText","setText","removefeatures","removeFeature","noroads","hasOwnProperty","li","append","prepend","dialog","maxHeight","autoOpen","deleteRoad2ListPanel","$li","$lis","deletestage2ListPanel","vectorOfPolygons","$stagelist","check_stage_list","a","b","contentA","contentB","$treasurehunt","prop","end","activateEdition","deactivateSaveButton","flyTo","point","fit","animate","show","setVisible","getExtent","selectstageFeatures","selected","changed","editFormstageEntry","location","href","newFormstageEntry","editFormRoadEntry","newFormRoadEntry","deleteRoad","json","removeLayer","deletestage","polygonFeature","savestages","callback","geojsonformat","dirtyfeatures","auxfeature","dirtyfeature","unset","geojsonstages","writeFeaturesObject","originalFeature","forEachFeature","apply","message","autocomplete","minLength","request","term","geocode","total","l","latitude","longitude","getLatitude","getLongitude","result","totalName","boundingbox","parseFloat","fromLonLat","autoFocus","value","prototype","_resizeMenu","ul","menu","outerWidth","confirm","$this_li","parents","editstatus","prevval","is","preventDefault","siblings","scrolltop","css","offset","outerHeight","dragging","pixel","getEventPixel","originalEvent","hit","forEachFeatureAtPixel","featureSelected","parent","tog","v","ev","val","change","onbeforeunload","returnValue","edittreasurehunt","terms","stringsqueried","component","get_strings","i18n","img","addEventListener","naturalWidth","naturalHeight","src"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http:// moodle.org/.\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify.\r\n// it under the terms of the GNU General Public License as published by.\r\n// the Free Software Foundation, either version 3 of the License, or.\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,.\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of.\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the.\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License.\r\n// along with Moodle.  If not, see <http:// www.gnu.org/licenses/>.\r\n/**\r\n * @module mod_treasurehunt/edit\r\n * @package mod_treasurehunt\r\n * @copyright 2016 onwards Adrian Rodriguez Fernandez <huorwhisp@gmail.com>,\r\n *            Juan Pablo de Castro <jpdecastro@tel.uva.es>\r\n * @author Adrian Rodriguez <huorwhisp@gmail.com>\r\n * @author Juan Pablo de Castro <jpdecastro@tel.uva.es>*\r\n * @license http:// www.gnu.org/copyleft/gpl.html GNU GPL v3 or later.\r\n * @license http:// www.gnu.org/copyleft/gpl.html GNU GPL v3 or later.\r\n */\r\n\r\ndefine(\r\n\t\t[ 'jquery', 'jqueryui', 'mod_treasurehunt/jquery-ui-touch-punch',\r\n\t\t\t\t'core/notification', 'mod_treasurehunt/ol', 'core/ajax',\r\n\t\t\t\t'mod_treasurehunt/geocoder',\r\n\t\t\t\t'mod_treasurehunt/ol3-layerswitcher', 'core/str' ],\r\n\t\tfunction($, jqui, touch, notification, ol, ajax, GeocoderJS,\r\n\t\t\t\tolLayerSwitcher, str) {\r\n\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tfunction initedittreasurehunt(idModule, treasurehuntid, strings, selectedroadid, lockid, custommapconfig) {\r\n\r\n\t\t\t\tvar mapprojection = 'EPSG:3857';\r\n\t\t\t\tvar mapprojobj = new ol.proj.Projection(mapprojection);\r\n\t\t\t\tvar custombaselayer = null;\r\n\t\t\t\tvar geographictools = true;\r\n\t\t\t\t// Support customized base layers.\r\n\t\t\t\tif (typeof(custommapconfig) != 'undefined' && custommapconfig != null) {\r\n\t\t\t\t\tif (custommapconfig.custombackgroundurl != null) {\r\n\t\t\t\t\t\tvar customimageextent = ol.proj.transformExtent(custommapconfig.bbox, 'EPSG:4326', mapprojection);\r\n\t\t\t\t\t\tif (!custommapconfig.geographic) {\r\n\t\t\t\t\t\t\t// Round bbox and scales to allow vectorial SVG rendering. (Maintain ratio.)\r\n\t\t\t\t\t\t\tvar bboxwidth = customimageextent[2] - customimageextent[0];\r\n\t\t\t\t\t\t\tvar bboxheight = customimageextent[3] - customimageextent[1];\r\n\t\t\t\t\t\t\tvar centerwidth = (customimageextent[2] + customimageextent[0]) / 2;\r\n\t\t\t\t\t\t\tvar centerheight = (customimageextent[3] + customimageextent[1]) / 2;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar ratiorealmap = Math.round(bboxheight / custommapconfig.imgheight);\r\n\t\t\t\t\t\t\tvar adjwidth = Math.round(custommapconfig.imgwidth * ratiorealmap);\r\n\t\t\t\t\t\t\tvar adjheight = Math.round(custommapconfig.imgheight * ratiorealmap);\r\n\t\t\t\t\t\t\tcustomimageextent = [centerwidth - adjwidth/2,\r\n\t\t\t\t\t\t\t\tcenterheight - adjheight/2,\r\n\t\t\t\t\t\t\t\tcenterwidth + adjwidth/2,\r\n\t\t\t\t\t\t\t\tcenterheight + adjheight/2];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tcustombaselayer = new ol.layer.Image({\r\n\t\t\t\t\t\t\t  title : custommapconfig.layername,\r\n\t\t\t\t\t\t\t  type: custommapconfig.layertype,\r\n\t\t\t\t\t\t      source: new ol.source.ImageStatic({\r\n\t\t\t\t\t\t        url: custommapconfig.custombackgroundurl,\r\n\t\t\t\t\t\t        imageExtent: customimageextent,\r\n\t\t\t\t\t\t      }),\r\n\t\t\t\t\t\t      opacity: 1.0\r\n\t\t\t\t\t\t    });\r\n\t\t\t\t\t} else if (custommapconfig.wmsurl != null) {\r\n\t\t\t\t\t\tvar options = {\r\n\t\t\t\t\t\t\t\t\tsource: new ol.source.TileWMS({\r\n\t\t\t\t\t\t\t            url: custommapconfig.wmsurl,\r\n\t\t\t\t\t\t\t            params: custommapconfig.wmsparams,\r\n\t\t\t\t\t\t\t          }),\r\n\t\t\t\t\t\t\t\t\ttype: custommapconfig.layertype,\r\n\t\t\t\t\t\t\t\t\ttitle: custommapconfig.layername,\r\n\t\t\t\t\t\t        };\r\n\t\t\t\t\t\tif (custommapconfig.bbox[0] != null &&\r\n\t\t\t\t\t\t\t\tcustommapconfig.bbox[1] != null &&\r\n\t\t\t\t\t\t\t\tcustommapconfig.bbox[2] != null &&\r\n\t\t\t\t\t\t\t\tcustommapconfig.bbox[3] != null) {\r\n\t\t\t\t\t\t\tvar customwmsextent = ol.proj.transformExtent(custommapconfig.bbox, 'EPSG:4326', mapprojection);\r\n\t\t\t\t\t\t\toptions.extent = customwmsextent;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcustombaselayer = new ol.layer.Tile(options);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgeographictools = custommapconfig.geographic;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar treasurehunt = {\r\n\t\t\t\t\t\"roads\" : {}\r\n\t\t\t\t}, dirtyStages = new ol.source.Vector({\r\n\t\t\t\t\tprojection : mapprojection\r\n\t\t\t\t}), originalStages = new ol.source.Vector({\r\n\t\t\t\t\tprojection : mapprojection\r\n\t\t\t\t}), dirty = false, abortDrawing = false, drawStarted = false, stageposition, roadid, stageid, selectedFeatures, selectedstageFeatures = {}, idNewFeature = 1, vectorSelected = new ol.layer.Vector(\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tsource : new ol.source.Vector({\r\n\t\t\t\t\t\t\t\tprojection : mapprojection\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}), openStreetMapGeocoder = GeocoderJS\r\n\t\t\t\t\t\t.createGeocoder('openstreetmap');\r\n\t\t\t\t\r\n\t\t\t\t// Load the control pane, treasurehunt and road list.\r\n\t\t\t\t$(\"#controlpanel\").addClass(\r\n\t\t\t\t\t\t'ui-widget-header ui-corner-all');\r\n\t\t\t\t$('<span id=\"edition\"/>').appendTo($(\"#controlpanel\"));\r\n\t\t\t\t$(\r\n\t\t\t\t\t\t'<input type=\"radio\" name=\"controlpanel\" id=\"addradio\" value=\"add\">')\r\n\t\t\t\t\t\t.appendTo($(\"#edition\"));\r\n\t\t\t\t$(\"<label>\").attr('for', \"addradio\").text(strings['add'])\r\n\t\t\t\t\t\t.appendTo($(\"#edition\"));\r\n\t\t\t\t$(\r\n\t\t\t\t\t\t'<input type=\"radio\" name=\"controlpanel\" id=\"modifyradio\" value=\"modify\">')\r\n\t\t\t\t\t\t.appendTo($(\"#edition\"));\r\n\t\t\t\t$(\"<label>\").attr('for', \"modifyradio\").text(strings['modify'])\r\n\t\t\t\t\t\t.appendTo($(\"#edition\"));\r\n\t\t\t\t$('<button id=\"savestage\"/>').attr('disabled', true).text(\r\n\t\t\t\t\t\tstrings['save']).appendTo($(\"#controlpanel\"));\r\n\t\t\t\t$('<button id=\"removefeature\"/>').attr('disabled', true)\r\n\t\t\t\t\t\t.text(strings['remove']).appendTo(\r\n\t\t\t\t\t\t\t\t$(\"#controlpanel\"));\r\n\t\t\t\tif (geographictools) {\r\n\t\t\t\t\t$('<div id=\"searchcontainer\">')\r\n\t\t\t\t\t\t\t.appendTo($(\"#controlpanel\"));\r\n\t\t\t\t\t$(\r\n\t\t\t\t\t\t\t'<input type=\"search\" placeholder=\"'\r\n\t\t\t\t\t\t\t\t\t+ strings['searchlocation']\r\n\t\t\t\t\t\t\t\t\t+ '\" class=\"searchaddress\"/>').appendTo(\r\n\t\t\t\t\t\t\t$(\"#searchcontainer\"));\r\n\t\t\t\t\t$(\r\n\t\t\t\t\t\t\t'<span class=\"ui-icon  ui-icon-search searchicon\"></span>')\r\n\t\t\t\t\t\t\t.prependTo($(\"#searchcontainer\"));\r\n\t\t\t\t\t$(\r\n\t\t\t\t\t\t\t'<span class=\"ui-icon  ui-icon-closethick closeicon invisible\"></span>')\r\n\t\t\t\t\t\t\t.appendTo($(\"#searchcontainer\"));\r\n\t\t\t\t}\r\n\t\t\t\t$('<button id=\"addstage\" />').text(strings['stage'])\r\n\t\t\t\t\t\t.prependTo($(\"#controlpanel\"));\r\n\t\t\t\t$('<button id=\"addroad\" />').text(strings['road'])\r\n\t\t\t\t\t\t.prependTo($(\"#controlpanel\"));\r\n\t\t\t\t$(\"#addradio\").button({\r\n\t\t\t\t\ttext : false,\r\n\t\t\t\t\ticons : {\r\n\t\t\t\t\t\tprimary : \"ui-icon-plusthick\"\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t$(\"#modifyradio\").button({\r\n\t\t\t\t\ttext : false,\r\n\t\t\t\t\ticons : {\r\n\t\t\t\t\t\tprimary : \"ui-icon-pencil\"\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t$(\"#removefeature\").button({\r\n\t\t\t\t\ttext : false,\r\n\t\t\t\t\ticons : {\r\n\t\t\t\t\t\tprimary : \"ui-icon-trash\"\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t$(\"#savestage\").button({\r\n\t\t\t\t\ttext : false,\r\n\t\t\t\t\ticons : {\r\n\t\t\t\t\t\tprimary : \"ui-icon-disk\"\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t$(\"#addstage\").button({\r\n\t\t\t\t\ticons : {\r\n\t\t\t\t\t\tprimary : \"ui-icon-circle-plus\"\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t$(\"#addroad\").button({\r\n\t\t\t\t\ticons : {\r\n\t\t\t\t\t\tprimary : \"ui-icon-circle-plus\"\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t// Lo cargo como un buttonset.\r\n\t\t\t\t$(\"#edition\").buttonset({disabled: true});\r\n\t\t\t\t// Hago visible el controlpanel.\r\n\t\t\t\t$(\"#controlpanel\").removeClass('invisible');\r\n\t\t\t\t// Creo el stagelist.\r\n\t\t\t\t$('<ul id=\"stagelist\"/>').prependTo($(\"#stagelistpanel\"));\r\n\t\t\t\t// Lo cargo como un sortable.\r\n\t\t\t\t$(\"#stagelist\")\r\n\t\t\t\t\t\t.sortable(\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\thandle : \".handle\",\r\n\t\t\t\t\t\t\t\t\ttolerance : \"pointer\",\r\n\t\t\t\t\t\t\t\t\tzIndex : 9999,\r\n\t\t\t\t\t\t\t\t\topacity : 0.5,\r\n\t\t\t\t\t\t\t\t\tforcePlaceholderSize : true,\r\n\t\t\t\t\t\t\t\t\tcursorAt : {\r\n\t\t\t\t\t\t\t\t\t\ttop : -7\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tcursor : \"n-resize\",\r\n\t\t\t\t\t\t\t\t\taxis : 'y',\r\n\t\t\t\t\t\t\t\t\titems : \"li:not(:hidden , .blocked)\",\r\n\t\t\t\t\t\t\t\t\thelper : \"clone\",\r\n\t\t\t\t\t\t\t\t\tstart : function(event, ui) {\r\n\t\t\t\t\t\t\t\t\t\tvar roadid = ui.item.attr('roadid'), start_pos = ui.item\r\n\t\t\t\t\t\t\t\t\t\t\t\t.index('li[roadid=\"'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ roadid + '\"]'), scrollParent = $(\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis).data(\"ui-sortable\").scrollParent, maxScrollTop = scrollParent[0].scrollHeight\r\n\t\t\t\t\t\t\t\t\t\t\t\t- scrollParent[0].clientHeight\r\n\t\t\t\t\t\t\t\t\t\t\t\t- ui.helper.height();\r\n\t\t\t\t\t\t\t\t\t\tui.item\r\n\t\t\t\t\t\t\t\t\t\t\t\t.data('start_pos',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstart_pos);\r\n\t\t\t\t\t\t\t\t\t\t// Set max scrollTop for sortable\r\n\t\t\t\t\t\t\t\t\t\t// scrolling.\r\n\t\t\t\t\t\t\t\t\t\t$(this).data('maxScrollTop',\r\n\t\t\t\t\t\t\t\t\t\t\t\tmaxScrollTop);\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tsort : function(e, ui) {\r\n\t\t\t\t\t\t\t\t\t\t// Check if scrolling is out of\r\n\t\t\t\t\t\t\t\t\t\t// boundaries.\r\n\t\t\t\t\t\t\t\t\t\tvar scrollParent = $(this).data(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\"ui-sortable\").scrollParent, maxScrollTop = $(\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis).data('maxScrollTop');\r\n\t\t\t\t\t\t\t\t\t\tif (scrollParent.scrollTop() > maxScrollTop) {\r\n\t\t\t\t\t\t\t\t\t\t\tscrollParent\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.scrollTop(maxScrollTop);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tupdate : function(event, ui) {\r\n\t\t\t\t\t\t\t\t\t\tvar start_pos = ui.item\r\n\t\t\t\t\t\t\t\t\t\t\t\t.data('start_pos'), roadid = ui.item\r\n\t\t\t\t\t\t\t\t\t\t\t\t.attr('roadid'), end_pos = ui.item\r\n\t\t\t\t\t\t\t\t\t\t\t\t.index('li[roadid=\"'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ roadid + '\"]'), $listitems = $(\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis).children(\r\n\t\t\t\t\t\t\t\t\t\t\t\t'li[roadid=\"' + roadid\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\"]'), $listlength = $($listitems).length, i;\r\n\t\t\t\t\t\t\t\t\t\tif (start_pos === end_pos) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tif (start_pos < end_pos) {\r\n\t\t\t\t\t\t\t\t\t\t\tfor (i = start_pos; i <= end_pos; i++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\trelocatestageList(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$listitems,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$listlength,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ti,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdirtyStages,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\toriginalStages,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttreasurehunt.roads[roadid].vector);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tfor (i = end_pos; i <= start_pos; i++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\trelocatestageList(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$listitems,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$listlength,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ti,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdirtyStages,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\toriginalStages,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttreasurehunt.roads[roadid].vector);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tactivateSaveButton();\r\n\t\t\t\t\t\t\t\t\t\tdirty = true;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}).disableSelection();\r\n\t\t\t\tfunction relocatestageList($listitems, $listlength, i,\r\n\t\t\t\t\t\tdirtyStages, originalStages, vector) {\r\n\t\t\t\t\tvar newVal, $item = $($listitems).get([ i ]), roadid = $(\r\n\t\t\t\t\t\t\t$item).attr('roadid');\r\n\t\t\t\t\tnewVal = Math.abs($($item).index(\r\n\t\t\t\t\t\t\t'li[roadid=\"' + roadid + '\"]')\r\n\t\t\t\t\t\t\t- $listlength);\r\n\t\t\t\t\t$($item).attr('stageposition', newVal);\r\n\t\t\t\t\t$($item).find('.sortable-number').text(newVal);\r\n\t\t\t\t\t// Si esta seleccionado cambiamos el valor de\r\n\t\t\t\t\t// stageposition.\r\n\t\t\t\t\tif ($($item).hasClass(\"ui-selected\")) {\r\n\t\t\t\t\t\tstageposition = newVal;\r\n\t\t\t\t\t}\r\n\t\t\t\t\trelocatenostage(parseInt($($item).attr('stageid'), 10),\r\n\t\t\t\t\t\t\tnewVal, parseInt($($item).attr('roadid'), 10),\r\n\t\t\t\t\t\t\tdirtyStages, originalStages, vector);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Creo el roadlistpanel.\r\n\t\t\t\t$('<ul id=\"roadlist\"/>').appendTo($(\"#roadlistpanel\"));\r\n\t\t\t\t// Anado los handle custom.\r\n\t\t\t\t/*\r\n\t\t\t\t * Set control\r\n\t\t\t\t * \r\n\t\t\t\t * @type edit_L27.ol.style.Style\r\n\t\t\t\t */\r\n\t\t\t\twindow.app = {};\r\n\t\t\t\tvar app = window.app;\r\n\t\t\t\t/**\r\n\t\t\t\t * @constructor\r\n\t\t\t\t * @extends {ol.control.Control}\r\n\t\t\t\t * @param {Object=}\r\n\t\t\t\t *            opt_options Control options.\r\n\t\t\t\t */\r\n\t\t\t\tapp.generateResizableControl = function(opt_options) {\r\n\t\t\t\t\tvar options = opt_options || {}, button = document\r\n\t\t\t\t\t\t\t.createElement('button'), element = document\r\n\t\t\t\t\t\t\t.createElement('div');\r\n\t\t\t\t\tbutton.innerHTML = '<>';\r\n\t\t\t\t\tbutton.id = 'egrip';\r\n\t\t\t\t\telement.className = 'ol-control ol-unselectable egrip-container';\r\n\t\t\t\t\telement.appendChild(button);\r\n\t\t\t\t\tol.control.Control.call(this, {\r\n\t\t\t\t\t\telement : element,\r\n\t\t\t\t\t\ttarget : options.target\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t\tol.inherits(app.generateResizableControl,\r\n\t\t\t\t\t\tol.control.Control);\r\n\t\t\t\t// Get style, vectors, map and interactions.\r\n\t\t\t\tvar defaultstageStyle = new ol.style.Style({\r\n\t\t\t\t\tfill : new ol.style.Fill({\r\n\t\t\t\t\t\tcolor : 'rgba(0, 0, 0, 0.1)'\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tstroke : new ol.style.Stroke({\r\n\t\t\t\t\t\tcolor : '#6C0492',\r\n\t\t\t\t\t\twidth : 2\r\n\t\t\t\t\t}),\r\n\t\t\t\t\timage : new ol.style.Circle({\r\n\t\t\t\t\t\tradius : 5,\r\n\t\t\t\t\t\tfill : new ol.style.Fill({\r\n\t\t\t\t\t\t\tcolor : '#ffcc33'\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tstroke : new ol.style.Stroke({\r\n\t\t\t\t\t\t\tcolor : '#000000',\r\n\t\t\t\t\t\t\twidth : 2\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}),\r\n\t\t\t\t\ttext : new ol.style.Text({\r\n\t\t\t\t\t\ttextAlign : 'center',\r\n\t\t\t\t\t\tscale : 1.3,\r\n\t\t\t\t\t\tfill : new ol.style.Fill({\r\n\t\t\t\t\t\t\tcolor : '#fff'\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tstroke : new ol.style.Stroke({\r\n\t\t\t\t\t\t\tcolor : '#6C0492',\r\n\t\t\t\t\t\t\twidth : 3.5\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t\t// Estilo etapa seleccionada.\r\n\t\t\t\tvar selectedstageStyle = new ol.style.Style({\r\n\t\t\t\t\tfill : new ol.style.Fill({\r\n\t\t\t\t\t\tcolor : 'rgba(0, 0, 0, 0.05)'\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tstroke : new ol.style.Stroke({\r\n\t\t\t\t\t\tcolor : '#FAC30B',\r\n\t\t\t\t\t\twidth : 2\r\n\t\t\t\t\t}),\r\n\t\t\t\t\timage : new ol.style.Circle({\r\n\t\t\t\t\t\tradius : 5,\r\n\t\t\t\t\t\tfill : new ol.style.Fill({\r\n\t\t\t\t\t\t\tcolor : '#ffcc33'\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tstroke : new ol.style.Stroke({\r\n\t\t\t\t\t\t\tcolor : '#000000',\r\n\t\t\t\t\t\t\twidth : 2\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}),\r\n\t\t\t\t\ttext : new ol.style.Text({\r\n\t\t\t\t\t\ttextAlign : 'center',\r\n\t\t\t\t\t\tscale : 1.3,\r\n\t\t\t\t\t\tfill : new ol.style.Fill({\r\n\t\t\t\t\t\t\tcolor : '#fff'\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tstroke : new ol.style.Stroke({\r\n\t\t\t\t\t\t\tcolor : '#ffcc33',\r\n\t\t\t\t\t\t\twidth : 3.5\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tzIndex : 'Infinity'\r\n\t\t\t\t});\r\n\t\t\t\tvar vectorDraw = new ol.layer.Vector({\r\n\t\t\t\t\tsource : new ol.source.Vector({\r\n\t\t\t\t\t\tprojection : 'EPSG:3857'\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tvisible : false\r\n\t\t\t\t});\r\n\t\t\t\tvar basemaps = new ol.layer.Group(\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t'title' : strings['basemaps'],\r\n\t\t\t\t\t\t\tlayers : [\r\n\t\t\t\t\t\t\t\t\tnew ol.layer.Tile(\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle : strings['aerialmap'],\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype : 'base',\r\n\t\t\t\t\t\t\t\t\t\t\t\tvisible : false,\r\n\t\t\t\t\t\t\t\t\t\t\t\tsource : new ol.source.BingMaps(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey : 'AmC3DXdnK5sXC_Yp_pOLqssFSaplBbvN68jnwKTEM3CSn2t6G5PGTbYN3wzxE5BR',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\timagerySet : 'AerialWithLabels',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaxZoom : 19\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Use maxZoom 19 to\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// see stretched\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// tiles instead of\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// the BingMaps.\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// \"no photos at\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// this zoom level\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// tiles.\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// maxZoom: 19.\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t}), \r\n\t\t\t\t\t\t\t\t\tnew ol.layer.Tile({\r\n\t\t\t\t\t\t\t\t\t\ttitle : strings['roadmap'],\r\n\t\t\t\t\t\t\t\t\t\ttype : 'base',\r\n\t\t\t\t\t\t\t\t\t\tvisible : true,\r\n\t\t\t\t\t\t\t\t\t\tsource : new ol.source.OSM()\r\n\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t});\r\n\t\t\t\tif (custombaselayer != null) {\r\n\t\t\t\t\tif (custommapconfig.onlybase) {\r\n\t\t\t\t\t\tbasemaps.getLayers().clear();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbasemaps.getLayers().push(custombaselayer);\r\n\t\t\t\t}\r\n\t\t\t\t// Popup showing the position the user clicked.\r\n\t\t\t\t// Elements that make up the popup.\r\n\t\t\t\tvar container = document.getElementById('popup');\r\n\t\t\t\tvar content = document.getElementById('popup-content');\r\n\t\t\t\tvar closer = document.getElementById('popup-closer');\r\n\t\t\t\t/**\r\n\t\t\t\t * Create an overlay to anchor the popup to the map.\r\n\t\t\t\t */\r\n\t\t\t\tvar overlay = new ol.Overlay(/** @type {olx.OverlayOptions} */\r\n\t\t\t\t({\r\n\t\t\t\t\telement : container,\r\n\t\t\t\t\tautoPan : true,\r\n\t\t\t\t\tautoPanAnimation : {\r\n\t\t\t\t\t\tduration : 250\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t\t/**\r\n\t\t\t\t * Add a click handler to hide the popup.\r\n\t\t\t\t * \r\n\t\t\t\t * @return {boolean} Don't follow the href.\r\n\t\t\t\t */\r\n\t\t\t\tcloser.onclick = function() {\r\n\t\t\t\t\toverlay.setPosition(undefined);\r\n\t\t\t\t\tcloser.blur();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t};\r\n\t\t\t\t// Layer selector...\r\n\t\t\t\tvar layerSwitcher = new ol.control.LayerSwitcher();\r\n\t\t\t\t// Map viewer...\r\n\t\t\t\tvar map = new ol.Map(\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlayers : [ basemaps, vectorDraw ],\r\n\t\t\t\t\t\t\toverlays : [ overlay ],\r\n\t\t\t\t\t\t\tprojection : mapprojobj,\r\n\t\t\t\t\t\t\trenderer : 'canvas',\r\n\t\t\t\t\t\t\ttarget : 'mapedit',\r\n\t\t\t\t\t\t\tview : new ol.View({\r\n\t\t\t\t\t\t\t\tcenter : [ 0, 0 ],\r\n\t\t\t\t\t\t\t\tzoom : 2,\r\n\t\t\t\t\t\t\t\tminZoom : 2\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\tcontrols : ol.control\r\n\t\t\t\t\t\t\t\t\t.defaults()\r\n\t\t\t\t\t\t\t\t\t.extend(\r\n\t\t\t\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlayerSwitcher,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tnew app.generateResizableControl(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttarget : document\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getElementById(\"stagelistpanel\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}) ])\r\n\t\t\t\t\t\t});\r\n\t\t\t\tfunction showpopup(evt) {\r\n\t\t\t\t\tvar coordinate = evt.coordinate;\r\n\t\t\t\t\tvar latlon = ol.proj.toLonLat(coordinate, map.getView()\r\n\t\t\t\t\t\t\t.getProjection());\r\n\t\t\t\t\tvar hdms = ol.coordinate.toStringHDMS(latlon);\r\n\t\t\t\t\tvar pegman = '<a target=\"street\" href=\"http://maps.google.com/?cbll='\r\n\t\t\t\t\t\t\t+ latlon[1]\r\n\t\t\t\t\t\t\t+ ','\r\n\t\t\t\t\t\t\t+ latlon[0]\r\n\t\t\t\t\t\t\t+ '&cbp=12,20.09,,0,5&layer=c\"><img src=\"pix/my_location.png\" width=\"16\" /></a>';\r\n\t\t\t\t\tcontent.innerHTML = '<code>' + pegman + ''\r\n\t\t\t\t\t\t\t+ hdms + '</code>';\r\n\t\t\t\t\toverlay.setPosition(coordinate);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmap.on('click', function(evt) {\r\n\t\t\t\t\tif (!Draw.getActive() && !Modify.getActive() &&\r\n\t\t\t\t\t\t(custommapconfig === null || custommapconfig.geographic)) {\r\n\t\t\t\t\t\tshowpopup(evt);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tlayerSwitcher.showPanel();\r\n\t\t\t\t// Creo el resizable.\r\n\t\t\t\t$(\"#stagelistpanel\").resizable({\r\n\t\t\t\t\thandles : {\r\n\t\t\t\t\t\t'e' : $('#egrip')\r\n\t\t\t\t\t},\r\n\t\t\t\t\tresize : function(event, ui) {\r\n\t\t\t\t\t\tui.size.height = ui.originalSize.height;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstop : function(event, ui) {\r\n\t\t\t\t\t\tmap.updateSize();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcancel : ''\r\n\t\t\t\t});\r\n\t\t\t\tvar Modify = {\r\n\t\t\t\t\tinit : function() {\r\n\t\t\t\t\t\tthis.select = new ol.interaction.Select(\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t// Si una feature puede ser seleccionada\r\n\t\t\t\t\t\t\t\t\t// o no.\r\n\t\t\t\t\t\t\t\t\tfilter : function(feature) {\r\n\t\t\t\t\t\t\t\t\t\tif (selectedstageFeatures[feature\r\n\t\t\t\t\t\t\t\t\t\t\t\t.getId()]) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tstyle : function(feature) {\r\n\t\t\t\t\t\t\t\t\t\tvar fill = new ol.style.Fill({\r\n\t\t\t\t\t\t\t\t\t\t\tcolor : 'rgba(255,255,255,0.4)'\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\tvar stroke = new ol.style.Stroke({\r\n\t\t\t\t\t\t\t\t\t\t\tcolor : '#3399CC',\r\n\t\t\t\t\t\t\t\t\t\t\twidth : 2\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\tvar styles = [ new ol.style.Style(\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\timage : new ol.style.Circle(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill : fill,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke : stroke,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tradius : 5\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill : fill,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke : stroke,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext : new ol.style.Text(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext : ''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ feature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.get('stageposition'),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttextAlign : 'center',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tscale : 1.3,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill : new ol.style.Fill(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcolor : '#fff'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke : new ol.style.Stroke(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcolor : '#3399CC',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidth : 3.5\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tzIndex : 'Infinity'\r\n\t\t\t\t\t\t\t\t\t\t\t\t}) ];\r\n\t\t\t\t\t\t\t\t\t\treturn styles;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\tmap.addInteraction(this.select);\r\n\t\t\t\t\t\tthis.modify = new ol.interaction.Modify({\r\n\t\t\t\t\t\t\tfeatures : this.select.getFeatures(),\r\n\t\t\t\t\t\t\tstyle : new ol.style.Style({\r\n\t\t\t\t\t\t\t\timage : new ol.style.Circle({\r\n\t\t\t\t\t\t\t\t\tradius : 5,\r\n\t\t\t\t\t\t\t\t\tfill : new ol.style.Fill({\r\n\t\t\t\t\t\t\t\t\t\tcolor : '#3399CC'\r\n\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\tstroke : new ol.style.Stroke({\r\n\t\t\t\t\t\t\t\t\t\tcolor : '#000000',\r\n\t\t\t\t\t\t\t\t\t\twidth : 2\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\tdeleteCondition : function(event) {\r\n\t\t\t\t\t\t\t\treturn ol.events.condition\r\n\t\t\t\t\t\t\t\t\t\t.shiftKeyOnly(event)\r\n\t\t\t\t\t\t\t\t\t\t&& ol.events.condition\r\n\t\t\t\t\t\t\t\t\t\t\t\t.singleClick(event);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tmap.addInteraction(this.modify);\r\n\t\t\t\t\t\tthis.setEvents();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsetEvents : function() {\r\n\t\t\t\t\t\t// Elimino la seleccion de features cuando cambia a\r\n\t\t\t\t\t\t// off.\r\n\t\t\t\t\t\tselectedFeatures = this.select.getFeatures();\r\n\t\t\t\t\t\tthis.select.on('change:active', function() {\r\n\t\t\t\t\t\t\tselectedFeatures.clear();\r\n\t\t\t\t\t\t\tdeactivateDeleteButton();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t// Activo o desactivo el boton de borrar segun tenga\r\n\t\t\t\t\t\t// una feature seleccionada o no.\r\n\t\t\t\t\t\tthis.select.on('select', function() {\r\n\t\t\t\t\t\t\tif (selectedFeatures.getLength() > 0) {\r\n\t\t\t\t\t\t\t\tactivateDeleteButton();\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdeactivateDeleteButton();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t// Activo el boton de guardar segun se haya\r\n\t\t\t\t\t\t// modificado algo o no.\r\n\t\t\t\t\t\tthis.modify.on('modifyend', function(e) {\r\n\t\t\t\t\t\t\tactivateSaveButton();\r\n\t\t\t\t\t\t\tmodifyFeatureToDirtySource(e.features,\r\n\t\t\t\t\t\t\t\t\toriginalStages, dirtyStages,\r\n\t\t\t\t\t\t\t\t\ttreasurehunt.roads[roadid].vector);\r\n\t\t\t\t\t\t\tdirty = true;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgetActive : function() {\r\n\t\t\t\t\t\treturn (this.select.getActive() && this.modify\r\n\t\t\t\t\t\t\t\t.getActive()) ? true : false;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsetActive : function(active) {\r\n\t\t\t\t\t\tthis.select.setActive(active);\r\n\t\t\t\t\t\tthis.modify.setActive(active);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tModify.init();\r\n\t\t\t\tvar Draw = {\r\n\t\t\t\t\tinit : function() {\r\n\t\t\t\t\t\tmap.addInteraction(this.Polygon);\r\n\t\t\t\t\t\tthis.Polygon.setActive(false);\r\n\t\t\t\t\t\tthis.setEvents();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tPolygon : new ol.interaction.Draw({\r\n\t\t\t\t\t\tsource : vectorDraw.getSource(),\r\n\t\t\t\t\t\ttype : /** @type {ol.geom.GeometryType} */\r\n\t\t\t\t\t\t('Polygon'),\r\n\t\t\t\t\t\tstyle : new ol.style.Style({\r\n\t\t\t\t\t\t\tfill : new ol.style.Fill({\r\n\t\t\t\t\t\t\t\tcolor : 'rgba(0, 0, 0, 0.05)'\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\tstroke : new ol.style.Stroke({\r\n\t\t\t\t\t\t\t\tcolor : '#FAC30B',\r\n\t\t\t\t\t\t\t\twidth : 2\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\timage : new ol.style.Circle({\r\n\t\t\t\t\t\t\t\tradius : 5,\r\n\t\t\t\t\t\t\t\tfill : new ol.style.Fill({\r\n\t\t\t\t\t\t\t\t\tcolor : '#ffcc33'\r\n\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\tstroke : new ol.style.Stroke({\r\n\t\t\t\t\t\t\t\t\tcolor : '#000000',\r\n\t\t\t\t\t\t\t\t\twidth : 2\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\tzIndex : 'Infinity'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tsetEvents : function() {\r\n\t\t\t\t\t\t// Fijo el treasurehunt al que pertenecen y activo\r\n\t\t\t\t\t\t// el boton de guardar .\r\n\t\t\t\t\t\t// segun se haya modificado algo o no.\r\n\t\t\t\t\t\tthis.Polygon.on('drawend', function(e) {\r\n\t\t\t\t\t\t\tdrawStarted = false;\r\n\t\t\t\t\t\t\tif (abortDrawing) {\r\n\t\t\t\t\t\t\t\tvectorDraw.getSource().clear();\r\n\t\t\t\t\t\t\t\tabortDrawing = false;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\te.feature.setProperties({\r\n\t\t\t\t\t\t\t\t\t'roadid' : roadid,\r\n\t\t\t\t\t\t\t\t\t'stageid' : stageid,\r\n\t\t\t\t\t\t\t\t\t'stageposition' : stageposition\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tselectedstageFeatures[idNewFeature] = true;\r\n\t\t\t\t\t\t\t\te.feature.setId(idNewFeature);\r\n\t\t\t\t\t\t\t\tidNewFeature++;\r\n\t\t\t\t\t\t\t\t// Agrego la nueva feature a su\r\n\t\t\t\t\t\t\t\t// correspondiente vector de poligonos.\r\n\t\t\t\t\t\t\t\ttreasurehunt.roads[roadid].vector\r\n\t\t\t\t\t\t\t\t\t\t.getSource().addFeature(e.feature);\r\n\t\t\t\t\t\t\t\t// Agrego la feature a la coleccion de\r\n\t\t\t\t\t\t\t\t// multipoligonos sucios.\r\n\t\t\t\t\t\t\t\taddNewFeatureToDirtySource(e.feature,\r\n\t\t\t\t\t\t\t\t\t\toriginalStages, dirtyStages);\r\n\t\t\t\t\t\t\t\t// Limpio el vector de dibujo.\r\n\t\t\t\t\t\t\t\tvectorDraw.getSource().clear();\r\n\t\t\t\t\t\t\t\tactivateSaveButton();\r\n\t\t\t\t\t\t\t\tdirty = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tthis.Polygon.on('drawstart', function(e) {\r\n\t\t\t\t\t\t\tdrawStarted = true;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgetActive : function() {\r\n\t\t\t\t\t\treturn this.Polygon.getActive();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsetActive : function(active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.Polygon.setActive(true);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.Polygon.setActive(false);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tmap.getTargetElement().style.cursor = active ? 'none'\r\n\t\t\t\t\t\t\t\t: '';\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t$(document).keyup(function(e) {\r\n\t\t\t\t\t// Si pulso la tecla esc dejo de dibujar.\r\n\t\t\t\t\tif (e.keyCode === 27 && drawStarted) // Esc.\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tabortDrawing = true;\r\n\t\t\t\t\t\tDraw.Polygon.finishDrawing();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tDraw.init();\r\n\t\t\t\tDraw.setActive(false);\r\n\t\t\t\tModify.setActive(false);\r\n\t\t\t\tdeactivateEdition();\r\n\t\t\t\t// The snap interaction must be added after the Modify and\r\n\t\t\t\t// Draw interactions.\r\n\t\t\t\t// in order for its map browser event handlers to be fired\r\n\t\t\t\t// first. Its handlers.\r\n\t\t\t\t// are responsible of doing the snapping.\r\n\t\t\t\tvar snap = new ol.interaction.Snap({\r\n\t\t\t\t\tsource : vectorDraw.getSource()\r\n\t\t\t\t});\r\n\t\t\t\tmap.addInteraction(snap);\r\n\t\t\t\t// Cargo las features.\r\n\t\t\t\tfetchTreasureHunt(treasurehuntid);\r\n\t\t\t\tfunction addNewFeatureToDirtySource(dirtyFeature,\r\n\t\t\t\t\t\toriginalStages, dirtySource) {\r\n\r\n\t\t\t\t\tvar stageid = dirtyFeature.get('stageid');\r\n\t\t\t\t\tvar roadid = dirtyFeature.get('roadid');\r\n\t\t\t\t\tvar feature = dirtySource.getFeatureById(stageid);\r\n\t\t\t\t\tif (!feature) {\r\n\t\t\t\t\t\tfeature = originalStages.getFeatureById(stageid)\r\n\t\t\t\t\t\t\t\t.clone();\r\n\t\t\t\t\t\tfeature.setId(stageid);\r\n\t\t\t\t\t\tdirtySource.addFeature(feature);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (feature.get('idFeaturesPolygons') === 'empty') {\r\n\t\t\t\t\t\tfeature.setProperties({\r\n\t\t\t\t\t\t\t'idFeaturesPolygons' : ''\r\n\t\t\t\t\t\t\t\t\t+ dirtyFeature.getId()\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t// Quito la advertencia.\r\n\t\t\t\t\t\tnotEmptystage(stageid, roadid);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfeature.setProperties({\r\n\t\t\t\t\t\t\t'idFeaturesPolygons' : feature\r\n\t\t\t\t\t\t\t\t\t.get('idFeaturesPolygons')\r\n\t\t\t\t\t\t\t\t\t+ ',' + dirtyFeature.getId()\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfeature.getGeometry().appendPolygon(\r\n\t\t\t\t\t\t\tdirtyFeature.getGeometry());\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction modifyFeatureToDirtySource(dirtyFeatures,\r\n\t\t\t\t\t\toriginalStages, dirtySource, vector) {\r\n\r\n\t\t\t\t\tdirtyFeatures\r\n\t\t\t\t\t\t\t.forEach(function(dirtyFeature) {\r\n\t\t\t\t\t\t\t\tvar stageid = dirtyFeature.get('stageid');\r\n\t\t\t\t\t\t\t\tvar feature = dirtySource\r\n\t\t\t\t\t\t\t\t\t\t.getFeatureById(stageid);\r\n\t\t\t\t\t\t\t\tvar idFeaturesPolygons;\r\n\t\t\t\t\t\t\t\tif (!feature) {\r\n\t\t\t\t\t\t\t\t\tfeature = originalStages\r\n\t\t\t\t\t\t\t\t\t\t\t.getFeatureById(stageid)\r\n\t\t\t\t\t\t\t\t\t\t\t.clone();\r\n\t\t\t\t\t\t\t\t\tfeature.setId(stageid);\r\n\t\t\t\t\t\t\t\t\tdirtySource.addFeature(feature);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tvar multipolygon = new ol.geom.MultiPolygon(\r\n\t\t\t\t\t\t\t\t\t\t[]);\r\n\t\t\t\t\t\t\t\t// Get those multipolygons of vector layer .\r\n\t\t\t\t\t\t\t\tidFeaturesPolygons = feature.get(\r\n\t\t\t\t\t\t\t\t\t\t'idFeaturesPolygons').split(\",\");\r\n\t\t\t\t\t\t\t\tfor (var i = 0, j = idFeaturesPolygons.length; i < j; i++) {\r\n\t\t\t\t\t\t\t\t\tmultipolygon.appendPolygon(vector\r\n\t\t\t\t\t\t\t\t\t\t\t.getSource().getFeatureById(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tidFeaturesPolygons[i])\r\n\t\t\t\t\t\t\t\t\t\t\t.getGeometry().clone());\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tfeature.setGeometry(multipolygon);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction removefeatureToDirtySource(dirtyFeatures,\r\n\t\t\t\t\t\toriginalStages, dirtySource, vector) {\r\n\r\n\t\t\t\t\tdirtyFeatures\r\n\t\t\t\t\t\t\t.forEach(function(dirtyFeature) {\r\n\r\n\t\t\t\t\t\t\t\tvar stageid = dirtyFeature.get('stageid');\r\n\t\t\t\t\t\t\t\tvar roadid = dirtyFeature.get('roadid');\r\n\t\t\t\t\t\t\t\tvar feature = dirtySource\r\n\t\t\t\t\t\t\t\t\t\t.getFeatureById(stageid);\r\n\t\t\t\t\t\t\t\tvar idFeaturesPolygons;\r\n\t\t\t\t\t\t\t\tvar remove;\r\n\t\t\t\t\t\t\t\tif (!feature) {\r\n\t\t\t\t\t\t\t\t\tfeature = originalStages\r\n\t\t\t\t\t\t\t\t\t\t\t.getFeatureById(stageid)\r\n\t\t\t\t\t\t\t\t\t\t\t.clone();\r\n\t\t\t\t\t\t\t\t\tfeature.setId(stageid);\r\n\t\t\t\t\t\t\t\t\tdirtySource.addFeature(feature);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tvar multipolygon = new ol.geom.MultiPolygon(\r\n\t\t\t\t\t\t\t\t\t\t[]);\r\n\t\t\t\t\t\t\t\t// Get those multipolygons of vector layer\r\n\t\t\t\t\t\t\t\t// which stageid isn't id of dirtyFeature.\r\n\t\t\t\t\t\t\t\tidFeaturesPolygons = feature.get(\r\n\t\t\t\t\t\t\t\t\t\t'idFeaturesPolygons').split(\",\");\r\n\t\t\t\t\t\t\t\tfor (var i = 0, j = idFeaturesPolygons.length; i < j; i++) {\r\n\t\t\t\t\t\t\t\t\tif (idFeaturesPolygons[i] != dirtyFeature\r\n\t\t\t\t\t\t\t\t\t\t\t.getId()) {\r\n\t\t\t\t\t\t\t\t\t\tmultipolygon\r\n\t\t\t\t\t\t\t\t\t\t\t\t.appendPolygon(vector\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getSource()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getFeatureById(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tidFeaturesPolygons[i])\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getGeometry()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.clone());\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tremove = i;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tfeature.setGeometry(multipolygon);\r\n\t\t\t\t\t\t\t\tif (multipolygon.getPolygons().length) {\r\n\t\t\t\t\t\t\t\t\tidFeaturesPolygons.splice(remove, 1);\r\n\t\t\t\t\t\t\t\t\tfeature\r\n\t\t\t\t\t\t\t\t\t\t\t.setProperties({\r\n\t\t\t\t\t\t\t\t\t\t\t\t'idFeaturesPolygons' : idFeaturesPolygons\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.join()\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfeature.setProperties({\r\n\t\t\t\t\t\t\t\t\t\t'idFeaturesPolygons' : 'empty'\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\temptystage(stageid, roadid);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction styleFunction(feature) {\r\n\t\t\t\t\t// Get the incomeLevel from the feature properties.\r\n\t\t\t\t\tvar stageposition = feature.get('stageposition');\r\n\t\t\t\t\tif (!isNaN(stageposition)) {\r\n\t\t\t\t\t\tselectedstageStyle.getText().setText(\r\n\t\t\t\t\t\t\t\t'' + stageposition);\r\n\t\t\t\t\t\tdefaultstageStyle.getText().setText(\r\n\t\t\t\t\t\t\t\t'' + stageposition);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// if there is no level or its one we don't recognize,.\r\n\t\t\t\t\t// return the default style (in an array!).\r\n\t\t\t\t\tif (selectedstageFeatures[feature.getId()]) {\r\n\t\t\t\t\t\treturn [ selectedstageStyle ];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// check the cache and create a new style for the\r\n\t\t\t\t\t// income.\r\n\t\t\t\t\t// level if its not been created before.\r\n\t\t\t\t\t// at this point, the style for the current level is in\r\n\t\t\t\t\t// the cache.\r\n\t\t\t\t\t// so return it (as an array!).\r\n\t\t\t\t\treturn [ defaultstageStyle ];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction fetchTreasureHunt(treasurehuntid) {\r\n\t\t\t\t\tvar geojson = ajax.call([ {\r\n\t\t\t\t\t\tmethodname : 'mod_treasurehunt_fetch_treasurehunt',\r\n\t\t\t\t\t\targs : {\r\n\t\t\t\t\t\t\ttreasurehuntid : treasurehuntid\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} ]);\r\n\t\t\t\t\tgeojson[0]\r\n\t\t\t\t\t\t\t.done(\r\n\t\t\t\t\t\t\t\t\tfunction(response) {\r\n\t\t\t\t\t\t\t\t\t\t$('.treasurehunt-editor-loader')\r\n\t\t\t\t\t\t\t\t\t\t\t\t.hide();\r\n\t\t\t\t\t\t\t\t\t\tif (response.status.code) {\r\n\t\t\t\t\t\t\t\t\t\t\tnotification.alert('Error',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tresponse.status.msg,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'Continue');\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tvar vector;\r\n\t\t\t\t\t\t\t\t\t\t\tvar geoJSONFeatures = response.treasurehunt.stages;\r\n\t\t\t\t\t\t\t\t\t\t\tvar geoJSON = new ol.format.GeoJSON();\r\n\t\t\t\t\t\t\t\t\t\t\tvar features;\r\n\t\t\t\t\t\t\t\t\t\t\tvar roads = response.treasurehunt.roads;\r\n\t\t\t\t\t\t\t\t\t\t\t// Moodle 2 returns an object\r\n\t\t\t\t\t\t\t\t\t\t\t// with indexed properties\r\n\t\t\t\t\t\t\t\t\t\t\t// instead an array...\r\n\t\t\t\t\t\t\t\t\t\t\tif (!Array.isArray(roads)) {\r\n\t\t\t\t\t\t\t\t\t\t\t\troads = Object\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.values(roads);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t// Necesito indexar cada camino\r\n\t\t\t\t\t\t\t\t\t\t\t// en el objeto global\r\n\t\t\t\t\t\t\t\t\t\t\t// treasurehunt.\r\n\t\t\t\t\t\t\t\t\t\t\troads\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.forEach(function(road) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// agrego los\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// vectores a cada\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// camino.\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// cast string \"0\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// or \"1\" to\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// boolean.\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\troad.blocked = road.blocked == true;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taddroad2ListPanel(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\troad.id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\troad.name,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\troad.blocked);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfeatures = geoJSON\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.readFeatures(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\troad.stages,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataProjection : 'EPSG:4326',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfeatureProjection : mapprojection\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\toriginalStages\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.addFeatures(features);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdelete road.stages;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvector = new ol.layer.Vector(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsource : new ol.source.Vector(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprojection : mapprojection\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tupdateWhileAnimating : true,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle : styleFunction\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfeatures\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.forEach(function(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfeature) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (feature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getGeometry() === null) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfeature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.setGeometry(new ol.geom.MultiPolygon(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t[]));\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar polygons = feature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getGeometry()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getPolygons();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar idNewFeatures = 'empty';\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar stageposition = feature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.get('stageposition');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar name = feature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.get('name');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar clue = feature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.get('clue');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar stageid = feature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getId();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar blocked = road.blocked;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var i = 0; i < polygons.length; i++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar newFeature = new ol.Feature(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfeature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getProperties());\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnewFeature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.setProperties({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'stageid' : stageid\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar polygon = polygons[i];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnewFeature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.setGeometry(polygon);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnewFeature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.setId(idNewFeature);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (i === 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tidNewFeatures = idNewFeature;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tidNewFeatures = idNewFeatures\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ ','\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ idNewFeature;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tidNewFeature++;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvector\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getSource()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.addFeature(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnewFeature);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfeature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.setProperties({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tidFeaturesPolygons : ''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ idNewFeatures\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taddstage2ListPanel(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstageid,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\troad.id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstageposition,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclue,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tblocked);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (polygons.length === 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temptystage(stageid);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\troad.vector = vector;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmap\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.addLayer(vector);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttreasurehunt.roads[road.id] = road;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Ordeno la lista de etapas.\r\n\t\t\t\t\t\t\t\t\t\t\tsortList();\r\n\t\t\t\t\t\t\t\t\t\t\t// Selecciono el camino de la\r\n\t\t\t\t\t\t\t\t\t\t\t// URL si existe o sino el\r\n\t\t\t\t\t\t\t\t\t\t\t// primero.\r\n\t\t\t\t\t\t\t\t\t\t\tif (typeof treasurehunt.roads[selectedroadid] !== 'undefined') {\r\n\t\t\t\t\t\t\t\t\t\t\t\troadid = selectedroadid;\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (treasurehunt.roads[roadid].blocked) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdeactivateAddstage();\r\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tactivateAddstage();\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tselectRoad(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\troadid,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttreasurehunt.roads[roadid].vector,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmap);\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tselectfirstroad(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttreasurehunt.roads,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmap);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}).fail(function(error) {\r\n\t\t\t\t\t\t\t\t$('.treasurehunt-editor-loader').hide();\r\n\t\t\t\t\t\t\t\tconsole.log(error);\r\n\t\t\t\t\t\t\t\tnotification.exception(error);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Panel functions .\r\n\t\t\t\tfunction removefeatures(selectedFeatures, vector) {\r\n\t\t\t\t\tselectedFeatures.forEach(function(feature) {\r\n\t\t\t\t\t\tvector.getSource().removeFeature(feature);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tselectedFeatures.clear();\r\n\t\t\t\t}\r\n\t\t\t\tfunction selectfirstroad(roads, map) {\r\n\t\t\t\t\tvar noroads = 0;\r\n\t\t\t\t\tfor ( var road in roads) {\r\n\t\t\t\t\t\tif (treasurehunt.roads.hasOwnProperty(road)) {\r\n\t\t\t\t\t\t\tnoroads = 1;\r\n\t\t\t\t\t\t\troadid = road;\r\n\t\t\t\t\t\t\tif (roads[roadid].blocked) {\r\n\t\t\t\t\t\t\t\tdeactivateAddstage();\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tactivateAddstage();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tselectRoad(roadid, roads[roadid].vector, map);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (noroads === 0) {\r\n\t\t\t\t\t\tdeactivateAddstage();\r\n\t\t\t\t\t\t$(\"#addroad\").addClass(\"highlightbutton\");\r\n\t\t\t\t\t\t$(\"#stagelistpanel\").addClass(\"invisible\");\r\n\t\t\t\t\t\tmap.updateSize();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction addstage2ListPanel(stageid, roadid, stageposition,\r\n\t\t\t\t\t\tname, clue, blocked) {\r\n\t\t\t\t\tif ($('#stagelist li[stageid=\"' + stageid + '\"]').length < 1) {\r\n\t\t\t\t\t\tvar li = $(\r\n\t\t\t\t\t\t\t\t'<li stageid=\"' + stageid + '\" roadid=\"'\r\n\t\t\t\t\t\t\t\t\t\t+ roadid + '\" stageposition=\"'\r\n\t\t\t\t\t\t\t\t\t\t+ stageposition + '\"/>').appendTo(\r\n\t\t\t\t\t\t\t\t$(\"#stagelist\"));\r\n\t\t\t\t\t\tli.addClass(\"ui-corner-all\")\r\n\t\t\t\t\t\t\t.append(\r\n\t\t\t\t\t\t\t\t\t\"<div class='stagename'>\" + name\r\n\t\t\t\t\t\t\t\t\t\t\t+ \"</div>\")\r\n\t\t\t\t\t\t\t.append(\r\n\t\t\t\t\t\t\t\t\t\"<div class='modifystage'>\"\r\n\t\t\t\t\t\t\t\t\t\t\t+ \"<span class='ui-icon ui-icon-pencil'></span>\"\r\n\t\t\t\t\t\t\t\t\t\t\t+ \"<span class='ui-icon ui-icon-info' data-id='#dialoginfo\"\r\n\t\t\t\t\t\t\t\t\t\t\t+ stageid + \"'>\"\r\n\t\t\t\t\t\t\t\t\t\t\t+ \"<div id='dialoginfo\"\r\n\t\t\t\t\t\t\t\t\t\t\t+ stageid + \"' title='\"\r\n\t\t\t\t\t\t\t\t\t\t\t+ name + \"'>\" + clue\r\n\t\t\t\t\t\t\t\t\t\t\t+ \"</div></span></div>\");\r\n\t\t\t\t\t\tif (blocked) {\r\n\t\t\t\t\t\t\tli.addClass(\"blocked\")\r\n\t\t\t\t\t\t\t\t.prepend(\r\n\t\t\t\t\t\t\t\t\t\t\"<div class='nohandle validstage'>\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ \"<span class='ui-icon ui-icon-locked'></span>\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ \"<span class='sortable-number'>\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ stageposition\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ \"</span></div>\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tli.prepend(\"<div class='handle validstage'>\"\r\n\t\t\t\t\t\t\t\t\t\t+ \"<span class='ui-icon ui-icon-arrowthick-2-n-s'></span>\"\r\n\t\t\t\t\t\t\t\t\t\t+ \"<span class='sortable-number'>\"\r\n\t\t\t\t\t\t\t\t\t\t+ stageposition\r\n\t\t\t\t\t\t\t\t\t\t+ \"</span></div>\");\r\n\t\t\t\t\t\t\tli.children(\".modifystage\")\r\n\t\t\t\t\t\t\t\t\t.prepend(\r\n\t\t\t\t\t\t\t\t\t\t\t\"<span class='ui-icon ui-icon-trash'></span>\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$('#dialoginfo' + stageid).dialog({\r\n\t\t\t\t\t\t\tmaxHeight : 500,\r\n\t\t\t\t\t\t\tautoOpen : false\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.log('El li con '\r\n\t\t\t\t\t\t\t\t\t\t+ stageid\r\n\t\t\t\t\t\t\t\t\t\t+ ' no ha podido crearse porque ya existia uno');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction addroad2ListPanel(roadid, name, blocked) {\r\n\t\t\t\t\t// Si no existe lo agrego.\r\n\t\t\t\t\tif ($('#roadlist li[roadid=\"' + roadid + '\"]').length < 1) {\r\n\t\t\t\t\t\tvar li = $(\r\n\t\t\t\t\t\t\t\t'<li roadid=\"' + roadid + '\" blocked=\"'\r\n\t\t\t\t\t\t\t\t\t\t+ blocked + '\"/>').appendTo(\r\n\t\t\t\t\t\t\t\t$(\"#roadlist\"));\r\n\t\t\t\t\t\tli\r\n\t\t\t\t\t\t\t\t.addClass(\"ui-corner-all\")\r\n\t\t\t\t\t\t\t\t.append(\r\n\t\t\t\t\t\t\t\t\t\t\"<div class='roadname'>\" + name\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ \"</div>\")\r\n\t\t\t\t\t\t\t\t.append(\r\n\t\t\t\t\t\t\t\t\t\t\"<div class='modifyroad'><span class='ui-icon ui-icon-trash'></span>\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ \"<span class='ui-icon ui-icon-pencil'></span></div>\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\tfunction deleteRoad2ListPanel(roadid) {\r\n\t\t\t\t\tvar $li = $('#roadlist li[roadid=\"' + roadid + '\"]');\r\n\t\t\t\t\tif ($li.length > 0) {\r\n\t\t\t\t\t\tvar $lis = $('#stagelist li[roadid=\"' + roadid\r\n\t\t\t\t\t\t\t\t+ '\"]');\r\n\t\t\t\t\t\t// Elimino el li del roadlist.\r\n\t\t\t\t\t\t$li.remove();\r\n\t\t\t\t\t\t// Elimino todos los li del stagelist.\r\n\t\t\t\t\t\t$lis.remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfunction deletestage2ListPanel(stageid, dirtySource,\r\n\t\t\t\t\t\toriginalStages, vectorOfPolygons) {\r\n\t\t\t\t\tvar $li = $('#stagelist li[stageid=\"' + stageid + '\"]');\r\n\t\t\t\t\tif ($li.length > 0) {\r\n\t\t\t\t\t\tvar roadid = $li.attr('roadid');\r\n\t\t\t\t\t\tvar start_pos = $li.index('li[roadid=\"' + roadid\r\n\t\t\t\t\t\t\t\t+ '\"]');\r\n\t\t\t\t\t\t// Elimino el li.\r\n\t\t\t\t\t\t$li.remove();\r\n\t\t\t\t\t\tvar $stagelist = $(\"#stagelist li[roadid='\"\r\n\t\t\t\t\t\t\t\t+ roadid + \"']\");\r\n\t\t\t\t\t\t// Compruebo el resto de etapas de la lista.\r\n\t\t\t\t\t\tcheck_stage_list($stagelist);\r\n\t\t\t\t\t\tvar $listlength = $stagelist.length;\r\n\t\t\t\t\t\t// Recoloco el resto.\r\n\t\t\t\t\t\tfor (var i = 0; i <= start_pos - 1; i++) {\r\n\t\t\t\t\t\t\trelocatestageList($stagelist, $listlength, i,\r\n\t\t\t\t\t\t\t\t\tdirtySource, originalStages,\r\n\t\t\t\t\t\t\t\t\tvectorOfPolygons);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfunction sortList() {\r\n\t\t\t\t\t// Ordeno la lista .\r\n\t\t\t\t\t$('#stagelist li').sort(\r\n\t\t\t\t\t\t\tfunction(a, b) {\r\n\t\t\t\t\t\t\t\tvar contentA = parseInt($(a).attr(\r\n\t\t\t\t\t\t\t\t\t\t'stageposition'));\r\n\t\t\t\t\t\t\t\tvar contentB = parseInt($(b).attr(\r\n\t\t\t\t\t\t\t\t\t\t'stageposition'));\r\n\t\t\t\t\t\t\t\treturn (contentA < contentB) ? 1\r\n\t\t\t\t\t\t\t\t\t\t: (contentA > contentB) ? -1 : 0;\r\n\t\t\t\t\t\t\t}).appendTo($(\"#stagelist\"));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction emptystage(stageid, roadid) {\r\n\t\t\t\t\tvar $treasurehunt = $('#stagelist li[stageid=\"'\r\n\t\t\t\t\t\t\t+ stageid + '\"]');\r\n\t\t\t\t\t$treasurehunt.children(\".handle,.nohandle\").addClass(\r\n\t\t\t\t\t\t\t'invalidstage').removeClass('validstage');\r\n\t\t\t\t\t// Compruebo si en este camino hay alguna etapa sin\r\n\t\t\t\t\t// geometria.\r\n\t\t\t\t\tif (roadid) {\r\n\t\t\t\t\t\t$(\"label[for='addradio']\")\r\n\t\t\t\t\t\t\t\t.addClass('highlightbutton');\r\n\t\t\t\t\t\tvar $stagelist = $(\"#stagelist li[roadid='\"\r\n\t\t\t\t\t\t\t\t+ roadid + \"']\");\r\n\t\t\t\t\t\tif ($stagelist.length >= 2) {\r\n\t\t\t\t\t\t\t$(\"#erremptystage\").removeClass(\"invisible\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction notEmptystage(stageid, roadid) {\r\n\t\t\t\t\tvar $treasurehunt = $('#stagelist li[stageid=\"'\r\n\t\t\t\t\t\t\t+ stageid + '\"]');\r\n\t\t\t\t\t$treasurehunt.children(\".handle, .nohandle\").addClass(\r\n\t\t\t\t\t\t\t'validstage').removeClass('invalidstage');\r\n\t\t\t\t\tif (roadid) {\r\n\t\t\t\t\t\t// Compruebo si en este camino hay alguna etapa sin\r\n\t\t\t\t\t\t// geometria.\r\n\t\t\t\t\t\t$(\"label[for='addradio']\").removeClass(\r\n\t\t\t\t\t\t\t\t'highlightbutton');\r\n\t\t\t\t\t\tvar $stagelist = $(\"#stagelist li[roadid='\"\r\n\t\t\t\t\t\t\t\t+ roadid + \"']\");\r\n\t\t\t\t\t\tif ($stagelist.find(\".invalidstage\").length === 0) {\r\n\t\t\t\t\t\t\t$(\"#erremptystage\").addClass(\"invisible\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction activateDeleteButton() {\r\n\t\t\t\t\t$('#removefeature').button(\"option\", \"disabled\", false);\r\n\t\t\t\t}\r\n\t\t\t\tfunction deactivateDeleteButton() {\r\n\t\t\t\t\t$('#removefeature').button(\"option\", \"disabled\", true);\r\n\t\t\t\t}\r\n\t\t\t\tfunction activateAddstage() {\r\n\t\t\t\t\t$('#addstage').button(\"option\", \"disabled\", false);\r\n\t\t\t\t}\r\n\t\t\t\tfunction deactivateAddstage() {\r\n\t\t\t\t\t$('#addstage').button(\"option\", \"disabled\", true);\r\n\t\t\t\t}\r\n\t\t\t\tfunction deactivateEdition() {\r\n\r\n\t\t\t\t\tvar radioButtons = $(\"#edition\").find(\"input:radio\");\r\n\t\t\t\t\t$(\"#edition\").find(\"input:radio\").prop(\"checked\", false).end()\r\n\t\t\t           .buttonset(\"refresh\");\r\n\t\t\t\t\t$(\"#edition\").buttonset(\"disable\");\r\n\r\n\t\t\t\t\tDraw.setActive(false);\r\n\t\t\t\t\tModify.setActive(false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction activateEdition() {\r\n\t\t\t\t\t$(\"#edition\").buttonset(\"enable\");\r\n\t\t\t\t}\r\n\t\t\t\tfunction activateSaveButton() {\r\n\t\t\t\t\t$('#savestage').button(\"option\", \"disabled\", false);\r\n\t\t\t\t}\r\n\t\t\t\tfunction deactivateSaveButton() {\r\n\t\t\t\t\t$('#savestage').button(\"option\", \"disabled\", true);\r\n\t\t\t\t}\r\n\t\t\t\tfunction flyTo(map, point, extent) {\r\n\t\t\t\t\tvar duration = 700;\r\n\t\t\t\t\tvar view = map.getView();\r\n\t\t\t\t\tif (extent) {\r\n\t\t\t\t\t\tview.fit(extent, {\r\n\t\t\t\t\t\t\tduration : duration\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tview.animate({\r\n\t\t\t\t\t\t\tzoom : 19,\r\n\t\t\t\t\t\t\tcenter : point,\r\n\t\t\t\t\t\t\tduration : duration\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfunction check_stage_list($stagelist) {\r\n\t\t\t\t\tif ($stagelist.length > 0) {\r\n\t\t\t\t\t\t$(\"#stagelistpanel\").removeClass(\"invisible\");\r\n\t\t\t\t\t\tmap.updateSize();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#stagelistpanel\").addClass(\"invisible\");\r\n\t\t\t\t\t\tmap.updateSize();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ($stagelist.length < 2) {\r\n\t\t\t\t\t\t$(\"#addstage\").addClass(\"highlightbutton\");\r\n\t\t\t\t\t\t$(\"#errvalidroad\").removeClass(\"invisible\");\r\n\t\t\t\t\t\t$(\"#erremptystage\").addClass(\"invisible\");\r\n\t\t\t\t\t} else if ($stagelist.find(\".invalidstage\").length > 0) {\r\n\t\t\t\t\t\t$(\"#addstage\").removeClass(\"highlightbutton\");\r\n\t\t\t\t\t\t$(\"#errvalidroad\").addClass(\"invisible\");\r\n\t\t\t\t\t\t$(\"#erremptystage\").removeClass(\"invisible\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#addstage\").removeClass(\"highlightbutton\");\r\n\t\t\t\t\t\t$(\"#errvalidroad\").addClass(\"invisible\");\r\n\t\t\t\t\t\t$(\"#erremptystage\").addClass(\"invisible\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfunction selectRoad(roadid, vectorOfPolygons, map) {\r\n\t\t\t\t\t// Limpio todas las features seleccionadas,oculto todos\r\n\t\t\t\t\t// los li y solo muestro los que tengan el roadid .\r\n\t\t\t\t\t$(\"#stagelist li\").removeClass(\"ui-selected\").hide();\r\n\t\t\t\t\tvar $stagelist = $(\"#stagelist li[roadid='\" + roadid\r\n\t\t\t\t\t\t\t+ \"']\");\r\n\t\t\t\t\t$stagelist.show();\r\n\t\t\t\t\tcheck_stage_list($stagelist);\r\n\t\t\t\t\t// Si no esta marcado el li road lo marco.\r\n\t\t\t\t\t$(\"#roadlist li[roadid='\" + roadid + \"']\").addClass(\r\n\t\t\t\t\t\t\t\"ui-selected\");\r\n\t\t\t\t\t// Dejo visible solo el vector con el roadid.\r\n\t\t\t\t\tmap.getLayers().forEach(function(layer) {\r\n\t\t\t\t\t\tif (layer instanceof ol.layer.Vector) {\r\n\t\t\t\t\t\t\tlayer.setVisible(false);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tvectorOfPolygons.setVisible(true);\r\n\t\t\t\t\tif (vectorOfPolygons.getSource().getFeatures().length > 0) {\r\n\t\t\t\t\t\tflyTo(map, null, vectorOfPolygons.getSource()\r\n\t\t\t\t\t\t\t\t.getExtent());\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction selectstageFeatures(vectorOfPolygons,\r\n\t\t\t\t\t\tvectorSelected, selected, selectedFeatures,\r\n\t\t\t\t\t\tdirtySource, originalStages) {\r\n\t\t\t\t\tvectorSelected.getSource().clear();\r\n\t\t\t\t\t// Deselecciono cualquier feature anterior.\r\n\t\t\t\t\tselectedFeatures.clear();\r\n\t\t\t\t\t// Reinicio el objeto.\r\n\t\t\t\t\tselectedstageFeatures = {};\r\n\t\t\t\t\tvar feature = dirtySource.getFeatureById(selected);\r\n\t\t\t\t\tif (!feature) {\r\n\t\t\t\t\t\tfeature = originalStages.getFeatureById(selected);\r\n\t\t\t\t\t\tif (!feature) {\r\n\t\t\t\t\t\t\t// Incremento la version para que se recargue el\r\n\t\t\t\t\t\t\t// mapa y se deseleccione la marcada\r\n\t\t\t\t\t\t\t// anteriormente.\r\n\t\t\t\t\t\t\tvectorOfPolygons.changed();\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (feature.get('idFeaturesPolygons') === 'empty') {\r\n\t\t\t\t\t\t// Incremento la version para que se recargue el\r\n\t\t\t\t\t\t// mapa y se deseleccione la marcada anteriormente.\r\n\t\t\t\t\t\tvectorOfPolygons.changed();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Agrego los poligonos a mi objecto que almacena los\r\n\t\t\t\t\t// poligonos seleccionados .\r\n\t\t\t\t\t// y tambien agrego al vector al que se le aplica la\r\n\t\t\t\t\t// animacion.\r\n\t\t\t\t\tvar idFeaturesPolygons = feature.get(\r\n\t\t\t\t\t\t\t'idFeaturesPolygons').split(\",\");\r\n\t\t\t\t\tfor (var i = 0, j = idFeaturesPolygons.length; i < j; i++) {\r\n\t\t\t\t\t\tvectorSelected.getSource().addFeature(\r\n\t\t\t\t\t\t\t\tvectorOfPolygons.getSource()\r\n\t\t\t\t\t\t\t\t\t\t.getFeatureById(\r\n\t\t\t\t\t\t\t\t\t\t\t\tidFeaturesPolygons[i])\r\n\t\t\t\t\t\t\t\t\t\t.clone());\r\n\t\t\t\t\t\tselectedstageFeatures[idFeaturesPolygons[i]] = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Coloco el mapa en la posicion de las etapas\r\n\t\t\t\t\t// seleccionadas si la etapa contiene alguna feature y .\r\n\t\t\t\t\t// postergando el tiempo para que seleccione la nueva\r\n\t\t\t\t\t// feature.\r\n\t\t\t\t\tif (vectorSelected.getSource().getFeatures().length) {\r\n\t\t\t\t\t\tflyTo(map, null, vectorSelected.getSource()\r\n\t\t\t\t\t\t\t\t.getExtent());\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction relocatenostage(stageid, stageposition, roadid,\r\n\t\t\t\t\t\tdirtySource, originalStages, vector) {\r\n\t\t\t\t\tvar feature = dirtySource.getFeatureById(stageid);\r\n\t\t\t\t\tvar idFeaturesPolygons;\r\n\t\t\t\t\tif (!feature) {\r\n\t\t\t\t\t\tfeature = originalStages.getFeatureById(stageid)\r\n\t\t\t\t\t\t\t\t.clone();\r\n\t\t\t\t\t\tfeature.setId(stageid);\r\n\t\t\t\t\t\tdirtySource.addFeature(feature);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfeature.setProperties({\r\n\t\t\t\t\t\t'stageposition' : stageposition\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (feature.get('idFeaturesPolygons') !== 'empty') {\r\n\t\t\t\t\t\tidFeaturesPolygons = feature.get(\r\n\t\t\t\t\t\t\t\t'idFeaturesPolygons').split(\",\");\r\n\t\t\t\t\t\tfor (var i = 0, j = idFeaturesPolygons.length; i < j; i++) {\r\n\t\t\t\t\t\t\tvector.getSource().getFeatureById(\r\n\t\t\t\t\t\t\t\t\tidFeaturesPolygons[i]).setProperties({\r\n\t\t\t\t\t\t\t\t'stageposition' : stageposition\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction editFormstageEntry(stageid, idModule) {\r\n\t\t\t\t\tvar url = 'editstage.php?cmid=' + idModule + '&id='\r\n\t\t\t\t\t\t\t+ stageid;\r\n\t\t\t\t\twindow.location.href = url;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction newFormstageEntry(roadid, idModule) {\r\n\t\t\t\t\tvar url = \"editstage.php?cmid=\" + idModule + \"&roadid=\"\r\n\t\t\t\t\t\t\t+ roadid;\r\n\t\t\t\t\twindow.location.href = url;\r\n\t\t\t\t}\r\n\t\t\t\tfunction editFormRoadEntry(roadid, idModule) {\r\n\t\t\t\t\tvar url = 'editroad.php?cmid=' + idModule + '&id='\r\n\t\t\t\t\t\t\t+ roadid;\r\n\t\t\t\t\twindow.location.href = url;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction newFormRoadEntry(idModule) {\r\n\t\t\t\t\tvar url = \"editroad.php?cmid=\" + idModule;\r\n\t\t\t\t\twindow.location.href = url;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction deleteRoad(roadid, dirtySource, originalStages,\r\n\t\t\t\t\t\ttreasurehuntid, lockid) {\r\n\t\t\t\t\t$('.treasurehunt-editor-loader').show();\r\n\t\t\t\t\tvar json = ajax.call([ {\r\n\t\t\t\t\t\tmethodname : 'mod_treasurehunt_delete_road',\r\n\t\t\t\t\t\targs : {\r\n\t\t\t\t\t\t\troadid : roadid,\r\n\t\t\t\t\t\t\ttreasurehuntid : treasurehuntid,\r\n\t\t\t\t\t\t\tlockid : lockid\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} ]);\r\n\t\t\t\t\tjson[0]\r\n\t\t\t\t\t\t\t.done(\r\n\t\t\t\t\t\t\t\t\tfunction(response) {\r\n\t\t\t\t\t\t\t\t\t\t$('.treasurehunt-editor-loader')\r\n\t\t\t\t\t\t\t\t\t\t\t\t.hide();\r\n\t\t\t\t\t\t\t\t\t\tif (response.status.code) {\r\n\t\t\t\t\t\t\t\t\t\t\tnotification.alert('Error',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tresponse.status.msg,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'Continue');\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t// Elimino tanto el li del road\r\n\t\t\t\t\t\t\t\t\t\t\t// como todos los li de stages\r\n\t\t\t\t\t\t\t\t\t\t\t// asociados.\r\n\t\t\t\t\t\t\t\t\t\t\tdeleteRoad2ListPanel(roadid);\r\n\t\t\t\t\t\t\t\t\t\t\t// Elimino la feature de\r\n\t\t\t\t\t\t\t\t\t\t\t// dirtySource si la tuviese, .\r\n\t\t\t\t\t\t\t\t\t\t\t// del originalStages y elimino\r\n\t\t\t\t\t\t\t\t\t\t\t// el camino del treasurehunt y\r\n\t\t\t\t\t\t\t\t\t\t\t// la capa del mapa.\r\n\t\t\t\t\t\t\t\t\t\t\tmap.removeLayer(treasurehunt.roads[roadid].vector);\r\n\t\t\t\t\t\t\t\t\t\t\tdelete treasurehunt.roads[roadid];\r\n\t\t\t\t\t\t\t\t\t\t\tselectfirstroad(treasurehunt.roads, map);\r\n\t\t\t\t\t\t\t\t\t\t\tdeactivateEdition();\r\n\t\t\t\t\t\t\t\t\t\t\tvar features = originalStages\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.getFeatures();\r\n\t\t\t\t\t\t\t\t\t\t\tfor (var i = 0; i < features.length; i++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (roadid === features[i]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.get('roadid')) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar dirtyFeature = dirtySource\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getFeatureById(features[i]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getId());\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (dirtyFeature) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdirtySource\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.removeFeature(dirtyFeature);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\toriginalStages\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.removeFeature(features[i]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}).fail(function(error) {\r\n\t\t\t\t\t\t\t\t$('.treasurehunt-editor-loader').hide();\r\n\t\t\t\t\t\t\t\tconsole.log(error);\r\n\t\t\t\t\t\t\t\tnotification.exception(error);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction deletestage(stageid, dirtySource, originalStages,\r\n\t\t\t\t\t\tvectorOfPolygons, treasurehuntid, lockid) {\r\n\t\t\t\t\t$('.treasurehunt-editor-loader').show();\r\n\t\t\t\t\tvar json = ajax.call([ {\r\n\t\t\t\t\t\tmethodname : 'mod_treasurehunt_delete_stage',\r\n\t\t\t\t\t\targs : {\r\n\t\t\t\t\t\t\tstageid : stageid,\r\n\t\t\t\t\t\t\ttreasurehuntid : treasurehuntid,\r\n\t\t\t\t\t\t\tlockid : lockid\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} ]);\r\n\t\t\t\t\tjson[0]\r\n\t\t\t\t\t\t\t.done(\r\n\t\t\t\t\t\t\t\t\tfunction(response) {\r\n\t\t\t\t\t\t\t\t\t\t$('.treasurehunt-editor-loader')\r\n\t\t\t\t\t\t\t\t\t\t\t\t.hide();\r\n\t\t\t\t\t\t\t\t\t\tif (response.status.code) {\r\n\t\t\t\t\t\t\t\t\t\t\tnotification.alert('Error',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tresponse.status.msg,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'Continue');\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tvar idFeaturesPolygons = false;\r\n\t\t\t\t\t\t\t\t\t\t\tvar polygonFeature;\r\n\t\t\t\t\t\t\t\t\t\t\tvar feature = dirtySource\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.getFeatureById(stageid);\r\n\t\t\t\t\t\t\t\t\t\t\t// Elimino y recoloco.\r\n\t\t\t\t\t\t\t\t\t\t\tdeletestage2ListPanel(stageid,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdirtySource,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\toriginalStages,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvectorOfPolygons);\r\n\t\t\t\t\t\t\t\t\t\t\t// Elimino la feature de\r\n\t\t\t\t\t\t\t\t\t\t\t// dirtySource si la tuviese y\r\n\t\t\t\t\t\t\t\t\t\t\t// todos los poligonos del\r\n\t\t\t\t\t\t\t\t\t\t\t// vector de poligonos.\r\n\t\t\t\t\t\t\t\t\t\t\tif (!feature) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tfeature = originalStages\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getFeatureById(stageid);\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (feature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.get('idFeaturesPolygons') !== 'empty') {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tidFeaturesPolygons = feature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.get(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'idFeaturesPolygons')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.split(\",\");\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\toriginalStages\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.removeFeature(feature);\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (feature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.get('idFeaturesPolygons') !== 'empty') {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tidFeaturesPolygons = feature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.get(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'idFeaturesPolygons')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.split(\",\");\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tdirtySource\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.removeFeature(feature);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tif (idFeaturesPolygons) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tfor (var i = 0, j = idFeaturesPolygons.length; i < j; i++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpolygonFeature = vectorOfPolygons\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getSource()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getFeatureById(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tidFeaturesPolygons[i]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvectorOfPolygons\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getSource()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.removeFeature(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpolygonFeature);\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}).fail(function(error) {\r\n\t\t\t\t\t\t\t\t$('.treasurehunt-editor-loader').hide();\r\n\t\t\t\t\t\t\t\tconsole.log(error);\r\n\t\t\t\t\t\t\t\tnotification.exception(error);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction savestages(dirtySource, originalStages,\r\n\t\t\t\t\t\ttreasurehuntid, callback, options, lockid) {\r\n\t\t\t\t\t$('.treasurehunt-editor-loader').show();\r\n\t\t\t\t\tvar geojsonformat = new ol.format.GeoJSON();\r\n\t\t\t\t\tvar dirtyfeatures = dirtySource.getFeatures();\r\n\t\t\t\t\tvar features = [];\r\n\t\t\t\t\tvar auxfeature;\r\n\t\t\t\t\t// Remove unnecessary feature properties .\r\n\t\t\t\t\tdirtyfeatures.forEach(function(dirtyfeature) {\r\n\t\t\t\t\t\tauxfeature = dirtyfeature.clone();\r\n\t\t\t\t\t\tauxfeature.unset(\"idFeaturesPolygons\");\r\n\t\t\t\t\t\tauxfeature.unset(\"name\");\r\n\t\t\t\t\t\tauxfeature.unset(\"clue\");\r\n\t\t\t\t\t\tauxfeature.unset(\"treasurehuntid\");\r\n\t\t\t\t\t\tauxfeature.setId(dirtyfeature.getId());\r\n\t\t\t\t\t\tfeatures.push(auxfeature);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tvar geojsonstages = geojsonformat.writeFeaturesObject(\r\n\t\t\t\t\t\t\tfeatures, {\r\n\t\t\t\t\t\t\t\tdataProjection : 'EPSG:4326',\r\n\t\t\t\t\t\t\t\tfeatureProjection : mapprojection\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\tvar json = ajax.call([ {\r\n\t\t\t\t\t\tmethodname : 'mod_treasurehunt_update_stages',\r\n\t\t\t\t\t\targs : {\r\n\t\t\t\t\t\t\tstages : geojsonstages,\r\n\t\t\t\t\t\t\ttreasurehuntid : treasurehuntid,\r\n\t\t\t\t\t\t\tlockid : lockid\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} ]);\r\n\t\t\t\t\tjson[0].done(\r\n\t\t\t\t\t\t\tfunction(response) {\r\n\t\t\t\t\t\t\t\t$('.treasurehunt-editor-loader').hide();\r\n\t\t\t\t\t\t\t\tif (response.status.code) {\r\n\t\t\t\t\t\t\t\t\tnotification\r\n\t\t\t\t\t\t\t\t\t\t\t.alert('Error',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tresponse.status.msg,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'Continue');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tvar originalFeature;\r\n\t\t\t\t\t\t\t\t\t// Paso las features \"sucias\" al objeto\r\n\t\t\t\t\t\t\t\t\t// con las features originales.\r\n\t\t\t\t\t\t\t\t\tdirtySource.forEachFeature(function(\r\n\t\t\t\t\t\t\t\t\t\t\tfeature) {\r\n\t\t\t\t\t\t\t\t\t\toriginalFeature = originalStages\r\n\t\t\t\t\t\t\t\t\t\t\t\t.getFeatureById(feature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getId());\r\n\t\t\t\t\t\t\t\t\t\toriginalFeature\r\n\t\t\t\t\t\t\t\t\t\t\t\t.setProperties(feature\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getProperties());\r\n\t\t\t\t\t\t\t\t\t\toriginalFeature.setGeometry(feature\r\n\t\t\t\t\t\t\t\t\t\t\t\t.getGeometry());\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t// Limpio mi objeto que guarda las\r\n\t\t\t\t\t\t\t\t\t// features sucias.\r\n\t\t\t\t\t\t\t\t\tdirtySource.clear();\r\n\t\t\t\t\t\t\t\t\t// Desactivo el boton de guardar.\r\n\t\t\t\t\t\t\t\t\tdeactivateSaveButton();\r\n\t\t\t\t\t\t\t\t\tdirty = false;\r\n\t\t\t\t\t\t\t\t\tif (typeof callback === \"function\"\r\n\t\t\t\t\t\t\t\t\t\t\t&& options instanceof Array) {\r\n\t\t\t\t\t\t\t\t\t\tcallback.apply(null, options);\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}).fail(\r\n\t\t\t\t\t\t\tfunction(error) {\r\n\t\t\t\t\t\t\t\t$('.treasurehunt-editor-loader').hide();\r\n\t\t\t\t\t\t\t\tconsole.log(error);\r\n\t\t\t\t\t\t\t\tnotification.alert('Error', error.message,\r\n\t\t\t\t\t\t\t\t\t\t'Continue');\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(\".searchaddress\")\r\n\t\t\t\t\t\t.autocomplete(\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tminLength : 4,\r\n\t\t\t\t\t\t\t\t\tsource : function(request, response) {\r\n\t\t\t\t\t\t\t\t\t\tvar term = request.term;\r\n\t\t\t\t\t\t\t\t\t\topenStreetMapGeocoder\r\n\t\t\t\t\t\t\t\t\t\t\t\t.geocode(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tterm,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfunction(data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!data[0]) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tresponse();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar total = [];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var i = 0, l = data.length; i < l; i++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar latitude;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar longitude;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlatitude = data[i]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getLatitude();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlongitude = data[i]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getLongitude();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar result = {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"value\" : data[i].totalName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"latitude\" : latitude,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"longitude\" : longitude,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"boundingbox\" : data[i].boundingbox\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttotal[i] = result;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tresponse(total);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tselect : function(event, ui) {\r\n\t\t\t\t\t\t\t\t\t\tif (ui.item.boundingbox) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar extend = [];\r\n\t\t\t\t\t\t\t\t\t\t\textend[0] = parseFloat(ui.item.boundingbox[2]);\r\n\t\t\t\t\t\t\t\t\t\t\textend[1] = parseFloat(ui.item.boundingbox[0]);\r\n\t\t\t\t\t\t\t\t\t\t\textend[2] = parseFloat(ui.item.boundingbox[3]);\r\n\t\t\t\t\t\t\t\t\t\t\textend[3] = parseFloat(ui.item.boundingbox[1]);\r\n\t\t\t\t\t\t\t\t\t\t\textend = ol.proj\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.transformExtent(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\textend,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'EPSG:4326',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmapprojection);\r\n\t\t\t\t\t\t\t\t\t\t\tflyTo(map, null, extend);\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tvar point = ol.proj\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.fromLonLat([\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tui.item.longitude,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tui.item.latitude ]);\r\n\t\t\t\t\t\t\t\t\t\t\tflyTo(map, point);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tautoFocus : true\r\n\t\t\t\t\t\t\t\t}).on(\"click\", function() {\r\n\t\t\t\t\t\t\t$(this).autocomplete(\"search\", $(this).value);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t// Necesario para regular la anchura de los resultados de\r\n\t\t\t\t// autocompletado.\r\n\t\t\t\t$.ui.autocomplete.prototype._resizeMenu = function() {\r\n\t\t\t\t\tvar ul = this.menu.element;\r\n\t\t\t\t\tul.outerWidth(this.element.outerWidth());\r\n\t\t\t\t};\r\n\t\t\t\t$(\"#addstage\").on(\r\n\t\t\t\t\t\t'click',\r\n\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\tif (dirty) {\r\n\t\t\t\t\t\t\t\tsavestages(dirtyStages, originalStages,\r\n\t\t\t\t\t\t\t\t\t\ttreasurehuntid, newFormstageEntry,\r\n\t\t\t\t\t\t\t\t\t\t[ roadid, idModule ], lockid);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tnewFormstageEntry(roadid, idModule);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t});\r\n\t\t\t\t$(\"#addroad\").on(\r\n\t\t\t\t\t\t'click',\r\n\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\tif (dirty) {\r\n\t\t\t\t\t\t\t\tsavestages(dirtyStages, originalStages,\r\n\t\t\t\t\t\t\t\t\t\ttreasurehuntid, newFormRoadEntry,\r\n\t\t\t\t\t\t\t\t\t\t[ idModule ], lockid);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tnewFormRoadEntry(idModule);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t$(\"#removefeature\")\r\n\t\t\t\t\t\t.on(\r\n\t\t\t\t\t\t\t\t'click',\r\n\t\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t\tnotification\r\n\t\t\t\t\t\t\t\t\t\t\t.confirm(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstrings['areyousure'],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstrings['removewarning'],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstrings['confirm'],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstrings['cancel'],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tremovefeatureToDirtySource(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedFeatures,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\toriginalStages,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdirtyStages,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttreasurehunt.roads[roadid].vector);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tremovefeatures(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedFeatures,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttreasurehunt.roads[roadid].vector);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Desactivo el\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// boton de borrar y\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// activo el de\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// guardar cambios.\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdeactivateDeleteButton();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tactivateSaveButton();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdirty = true;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t$(\"#savestage\").on(\r\n\t\t\t\t\t\t'click',\r\n\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\tsavestages(dirtyStages, originalStages,\r\n\t\t\t\t\t\t\t\t\ttreasurehuntid, null, null, lockid);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t$(\"#stagelist\").on('click',\r\n\t\t\t\t\t\t'.ui-icon-info, .ui-icon-alert', function() {\r\n\t\t\t\t\t\t\tvar id = $(this).data('id');\r\n\t\t\t\t\t\t\t// Open dialogue.\r\n\t\t\t\t\t\t\t$(id).dialog(\"open\");\r\n\t\t\t\t\t\t\t// Remove focus from the buttons.\r\n\t\t\t\t\t\t\t$('.ui-dialog :button').blur();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t$(\"#stagelist\")\r\n\t\t\t\t\t\t.on(\r\n\t\t\t\t\t\t\t\t'click',\r\n\t\t\t\t\t\t\t\t'.ui-icon-trash',\r\n\t\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t\tvar $this_li = $(this).parents('li');\r\n\t\t\t\t\t\t\t\t\tnotification\r\n\t\t\t\t\t\t\t\t\t\t\t.confirm(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstrings['areyousure'],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstrings['removewarning'],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstrings['confirm'],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstrings['cancel'],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar stageid = parseInt($this_li\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr('stageid'));\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdeletestage(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstageid,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdirtyStages,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\toriginalStages,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttreasurehunt.roads[roadid].vector,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttreasurehuntid,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlockid);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t$(\"#stagelist\").on(\r\n\t\t\t\t\t\t'click',\r\n\t\t\t\t\t\t'.ui-icon-pencil',\r\n\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t// Busco el stageid del li que contiene la\r\n\t\t\t\t\t\t\t// papelera seleccionada.\r\n\r\n\t\t\t\t\t\t\tvar stageid = parseInt($(this).parents('li')\r\n\t\t\t\t\t\t\t\t\t.attr('stageid'));\r\n\t\t\t\t\t\t\t// Si esta sucio guardo el escenario.\r\n\t\t\t\t\t\t\tif (dirty) {\r\n\t\t\t\t\t\t\t\tsavestages(dirtyStages, originalStages,\r\n\t\t\t\t\t\t\t\t\t\ttreasurehuntid, editFormstageEntry,\r\n\t\t\t\t\t\t\t\t\t\t[ stageid, idModule ], lockid);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\teditFormstageEntry(stageid, idModule);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t});\r\n\t\t\t\tvar editstatus = 'off';\r\n\t\t\t\t$(\"input[name=controlpanel]:radio\")\r\n\t\t\t\t\t\t.on(\r\n\t\t\t\t\t\t\t\t'click',\r\n\t\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tvar prevval = editstatus;\r\n\t\t\t\t\t\t\t\t\tvar value = $(this).prop('id');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (value==prevval){\r\n\t\t\t\t\t\t\t\t\t\t// Toggle.\r\n\t\t\t\t\t\t\t\t\t\t$(\"#edition\").find(\"input:radio\").buttonset().prop('checked', false).end().buttonset('refresh');\r\n\t\t\t\t\t\t\t\t\t\tvalue = 'off';\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\teditstatus = value;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (value === 'addradio') {\r\n\t\t\t\t\t\t\t\t\t\tDraw.setActive(true);\r\n\t\t\t\t\t\t\t\t\t\tModify.setActive(false);\r\n\t\t\t\t\t\t\t\t\t} else if (value === 'modifyradio') {\r\n\t\t\t\t\t\t\t\t\t\tDraw.setActive(false);\r\n\t\t\t\t\t\t\t\t\t\tModify.setActive(true);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tDraw.setActive(false);\r\n\t\t\t\t\t\t\t\t\t\tModify.setActive(false);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t$(\"#stagelist\")\r\n\t\t\t\t\t\t.on(\r\n\t\t\t\t\t\t\t\t'click',\r\n\t\t\t\t\t\t\t\t'li',\r\n\t\t\t\t\t\t\t\tfunction(e) {\r\n\t\t\t\t\t\t\t\t\tif ($(e.target)\r\n\t\t\t\t\t\t\t\t\t\t\t.is(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'.handle ,.nohandle, .ui-icon , .sortable-number')) {\r\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t$(this).addClass(\"ui-selected\")\r\n\t\t\t\t\t\t\t\t\t\t\t.siblings().removeClass(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"ui-selected\");\r\n\t\t\t\t\t\t\t\t\t// Selecciono el stageid de mi atributo\r\n\t\t\t\t\t\t\t\t\t// custom.\r\n\t\t\t\t\t\t\t\t\tstageposition = parseInt($(this).attr(\r\n\t\t\t\t\t\t\t\t\t\t\t'stageposition'));\r\n\t\t\t\t\t\t\t\t\tstageid = parseInt($(this).attr(\r\n\t\t\t\t\t\t\t\t\t\t\t'stageid'));\r\n\t\t\t\t\t\t\t\t\t// Borro la anterior seleccion de\r\n\t\t\t\t\t\t\t\t\t// features y busco las del mismo tipo.\r\n\t\t\t\t\t\t\t\t\tselectstageFeatures(\r\n\t\t\t\t\t\t\t\t\t\t\ttreasurehunt.roads[roadid].vector,\r\n\t\t\t\t\t\t\t\t\t\t\tvectorSelected, stageid,\r\n\t\t\t\t\t\t\t\t\t\t\tselectedFeatures, dirtyStages,\r\n\t\t\t\t\t\t\t\t\t\t\toriginalStages);\r\n\t\t\t\t\t\t\t\t\tactivateEdition();\r\n\t\t\t\t\t\t\t\t\t// Si la etapa no tiene geometra\r\n\t\t\t\t\t\t\t\t\t// resalto el boton de anadir.\r\n\t\t\t\t\t\t\t\t\tif ($(this).find(\".invalidstage\").length > 0) {\r\n\t\t\t\t\t\t\t\t\t\t$(\"label[for='addradio']\").addClass(\r\n\t\t\t\t\t\t\t\t\t\t\t\t'highlightbutton');\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t$(\"label[for='addradio']\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t.removeClass(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'highlightbutton');\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t// Paro de dibujar si cambio de etapa.\r\n\t\t\t\t\t\t\t\t\tif (drawStarted) {\r\n\t\t\t\t\t\t\t\t\t\tabortDrawing = true;\r\n\t\t\t\t\t\t\t\t\t\tDraw.Polygon.finishDrawing();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t$(\"#roadlist\")\r\n\t\t\t\t\t\t.on(\r\n\t\t\t\t\t\t\t\t'click',\r\n\t\t\t\t\t\t\t\t'li',\r\n\t\t\t\t\t\t\t\tfunction(e) {\r\n\t\t\t\t\t\t\t\t\tif ($(e.target).is('.ui-icon')) {\r\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t$(this).addClass(\"ui-selected\")\r\n\t\t\t\t\t\t\t\t\t\t\t.siblings().removeClass(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"ui-selected\");\r\n\t\t\t\t\t\t\t\t\t// Selecciono el stageid de mi atributo\r\n\t\t\t\t\t\t\t\t\t// custom.\r\n\t\t\t\t\t\t\t\t\t// Borro las etapas seleccionadas.\r\n\t\t\t\t\t\t\t\t\tselectedstageFeatures = {};\r\n\t\t\t\t\t\t\t\t\t// Paro de dibujar si cambio de camino.\r\n\t\t\t\t\t\t\t\t\tif (drawStarted) {\r\n\t\t\t\t\t\t\t\t\t\tabortDrawing = true;\r\n\t\t\t\t\t\t\t\t\t\tDraw.Polygon.finishDrawing();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\troadid = $(this).attr('roadid');\r\n\t\t\t\t\t\t\t\t\tvar blocked = $(this).attr('blocked');\r\n\t\t\t\t\t\t\t\t\tif (parseInt(blocked)\r\n\t\t\t\t\t\t\t\t\t\t\t|| blocked === 'true') {\r\n\t\t\t\t\t\t\t\t\t\tdeactivateAddstage();\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tactivateAddstage();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tselectRoad(\r\n\t\t\t\t\t\t\t\t\t\t\troadid,\r\n\t\t\t\t\t\t\t\t\t\t\ttreasurehunt.roads[roadid].vector,\r\n\t\t\t\t\t\t\t\t\t\t\tmap);\r\n\t\t\t\t\t\t\t\t\tdeactivateEdition();\r\n\t\t\t\t\t\t\t\t\t// Scroll to editor.\r\n\t\t\t\t\t\t\t\t\tvar scrolltop;\r\n\t\t\t\t\t\t\t\t\tif ($('header[role=banner]').css(\r\n\t\t\t\t\t\t\t\t\t\t\t\"position\") === \"fixed\") {\r\n\t\t\t\t\t\t\t\t\t\tscrolltop = parseInt($(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\".treasurehunt-editor\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t.offset().top)\r\n\t\t\t\t\t\t\t\t\t\t\t\t- parseInt($(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'header[role=banner]')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.outerHeight(true));\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tscrolltop = parseInt($(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\".treasurehunt-editor\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t.offset().top);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t$('html, body').animate({\r\n\t\t\t\t\t\t\t\t\t\tscrollTop : scrolltop\r\n\t\t\t\t\t\t\t\t\t}, 500);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t$(\"#roadlist\").on(\r\n\t\t\t\t\t\t'click',\r\n\t\t\t\t\t\t'.ui-icon-pencil',\r\n\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t// Busco el roadid del li que contiene el\r\n\t\t\t\t\t\t\t// lapicero seleccionado.\r\n\t\t\t\t\t\t\tvar roadid = parseInt($(this).parents('li')\r\n\t\t\t\t\t\t\t\t\t.attr('roadid'));\r\n\t\t\t\t\t\t\t// Si esta sucio guardo el escenario.\r\n\t\t\t\t\t\t\tif (dirty) {\r\n\t\t\t\t\t\t\t\tsavestages(dirtyStages, originalStages,\r\n\t\t\t\t\t\t\t\t\t\ttreasurehuntid, editFormRoadEntry,\r\n\t\t\t\t\t\t\t\t\t\t[ roadid, idModule ], lockid);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\teditFormRoadEntry(roadid, idModule);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t});\r\n\t\t\t\t$(\"#roadlist\").on(\r\n\t\t\t\t\t\t'click',\r\n\t\t\t\t\t\t'.ui-icon-trash',\r\n\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\tvar $this_li = $(this).parents('li');\r\n\t\t\t\t\t\t\tnotification.confirm(strings['areyousure'],\r\n\t\t\t\t\t\t\t\t\tstrings['removeroadwarning'],\r\n\t\t\t\t\t\t\t\t\tstrings['confirm'], strings['cancel'],\r\n\t\t\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t\t\tvar roadid = parseInt($this_li\r\n\t\t\t\t\t\t\t\t\t\t\t\t.attr('roadid'));\r\n\t\t\t\t\t\t\t\t\t\tdeleteRoad(roadid, dirtyStages,\r\n\t\t\t\t\t\t\t\t\t\t\t\toriginalStages,\r\n\t\t\t\t\t\t\t\t\t\t\t\ttreasurehuntid, lockid);\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\tmap.on('pointermove', function(evt) {\r\n\t\t\t\t\tif (evt.dragging || Draw.getActive()\r\n\t\t\t\t\t\t\t|| !Modify.getActive()) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar pixel = map.getEventPixel(evt.originalEvent);\r\n\t\t\t\t\tvar hit = map.forEachFeatureAtPixel(pixel, function(\r\n\t\t\t\t\t\t\tfeature, layer) {\r\n\t\t\t\t\t\tif (selectedstageFeatures[feature.getId()]) {\r\n\t\t\t\t\t\t\tvar selected = false;\r\n\t\t\t\t\t\t\tselectedFeatures.forEach(function(\r\n\t\t\t\t\t\t\t\t\tfeatureSelected) {\r\n\t\t\t\t\t\t\t\tif (feature === featureSelected) {\r\n\t\t\t\t\t\t\t\t\tselected = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn selected ? false : true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tmap.getTargetElement().style.cursor = hit ? 'pointer'\r\n\t\t\t\t\t\t\t: '';\r\n\t\t\t\t});\r\n\t\t\t\t// Evento para que funcione bien el boton de cerrar en\r\n\t\t\t\t// dispositivos tactiles.\r\n\t\t\t\t$(document).on(\r\n\t\t\t\t\t\t'touchend',\r\n\t\t\t\t\t\t'.ui-dialog-titlebar-close',\r\n\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t$(this).parent().siblings('.ui-dialog-content')\r\n\t\t\t\t\t\t\t\t\t.dialog(\"close\");\r\n\t\t\t\t\t\t});\r\n\t\t\t\t// CLEARABLE INPUT.\r\n\t\t\t\tfunction tog(v) {\r\n\t\t\t\t\treturn v ? 'removeClass' : 'addClass';\r\n\t\t\t\t}\r\n\t\t\t\t$('.searchaddress').on('input', function() {\r\n\t\t\t\t\t$('.closeicon')[tog(this.value)]('invisible');\r\n\t\t\t\t});\r\n\t\t\t\t$('.closeicon').on(\r\n\t\t\t\t\t\t'touchstart click',\r\n\t\t\t\t\t\tfunction(ev) {\r\n\t\t\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\t\t\t$(this).addClass('invisible');\r\n\t\t\t\t\t\t\t$('.searchaddress').val('').change()\r\n\t\t\t\t\t\t\t\t\t.autocomplete(\"close\");\r\n\t\t\t\t\t\t});\r\n\t\t\t\t// Al salirse.\r\n\t\t\t\twindow.onbeforeunload = function(e) {\r\n\t\t\t\t\tvar message = strings['savewarning'], e = e\r\n\t\t\t\t\t\t\t|| window.event;\r\n\t\t\t\t\tif (dirty) {\r\n\t\t\t\t\t\t// For IE and Firefox.\r\n\t\t\t\t\t\tif (e) {\r\n\t\t\t\t\t\t\te.returnValue = message;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// For Safari.\r\n\t\t\t\t\t\treturn message;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tvar init = {\r\n\t\t\t\tedittreasurehunt : function(idModule, treasurehuntid, selectedroadid, lockid, custommapconfig) {\r\n\t\t\t\t\t// I18n strings.\r\n\t            \tvar terms = ['stage', 'road', 'aerialmap', 'roadmap', 'basemaps', 'add', 'modify', 'save',\r\n\t\t\t                    'remove', 'searchlocation', 'savewarning', 'removewarning',\r\n\t\t\t                    'areyousure', 'removeroadwarning', 'confirm', 'cancel'];\r\n\t            \tvar stringsqueried = terms.map(function (term) {\r\n\t                     return {key: term, component: 'treasurehunt'};\r\n\t                });\r\n\t            \tstr.get_strings(stringsqueried).done(function (strings) {\r\n\t            \t\tvar i18n = [];\r\n\t            \t\tfor (var i=0; i < terms.length; i++) {\r\n\t            \t\t\ti18n[terms[i]] = strings[i];\r\n\t            \t\t}\r\n\t            \t\t// Detect custom image.\r\n\t            \t\tif (typeof(custommapconfig) != 'undefined' &&\r\n\t            \t\t\t\tcustommapconfig !== null && \r\n\t            \t\t\t\tcustommapconfig.custombackgroundurl !== null) {\r\n\t            \t\t\t\r\n\t            \t\t\t// Detect image size.\r\n\t    \t\t\t\t\t\tvar img = new Image();\r\n\t    \t\t\t\t\t    img.addEventListener(\"load\", function(){\r\n\t    \t\t\t\t\t    \tcustommapconfig.imgwidth =  this.naturalWidth;\r\n\t    \t\t\t\t\t    \tcustommapconfig.imgheight = this.naturalHeight;\r\n\t    \t            \t\t\tinitedittreasurehunt(idModule, treasurehuntid, i18n, selectedroadid, lockid, custommapconfig);\t    \t\t\t\t\t        \r\n\t    \t\t\t\t\t    });\r\n\t    \t\t\t\t\t    img.src = custommapconfig.custombackgroundurl;\r\n\t            \t\t} else {\r\n\t            \t\t\tinitedittreasurehunt(idModule, treasurehuntid, i18n, selectedroadid, lockid, custommapconfig);\r\n\t            \t\t}\r\n\t                });\r\n\t\t\t\t} // End of function edittreasurehunt.\r\n\t\t\t}; // End of init var.\r\n\t\t\treturn init;\r\n\t\t});\r\n"],"file":"edit.min.js"}