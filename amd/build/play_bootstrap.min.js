define("mod_treasurehunt/play_bootstrap",["exports","jquery","core/url","mod_treasurehunt/ol","core/ajax","mod_treasurehunt/osm-geocoder","mod_treasurehunt/viewgpx","core/str","mod_treasurehunt/webqr","mod_treasurehunt/jquery.truncate","mod_treasurehunt/dropdown"],(function(_exports,_jquery,_url,_ol,_ajax,_osmGeocoder,_viewgpx,_str,_webqr,_jquery2,_dropdown){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module play_bootstrap_new
   *
   * @module     mod_treasurehunt/play_bootstrap_new
   * @copyright  2025 YOUR NAME <your@email.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
/**
   * @module    mod_treasurehunt/play
   * @package
   * @copyright 2016 onwards Adrian Rodriguez Fernandez <huorwhisp@gmail.com>, Juan Pablo de Castro <jpdecastro@tel.uva.es>
   * @author Adrian Rodriguez <huorwhisp@gmail.com>
   * @author Juan Pablo de Castro <jpdecastro@tel.uva.es>
   * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */function calculateCustomImageExtent(custommapconfig,mapprojection){let referencetocenter=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var customimageextent=_ol.default.proj.transformExtent(custommapconfig.bbox,"EPSG:4326",mapprojection);if(1==custommapconfig.preserveaspectratio){var bboxheight=customimageextent[3]-customimageextent[1],centerwidth=(customimageextent[2]+customimageextent[0])/2,centerheight=(customimageextent[3]+customimageextent[1])/2,ratiorealmap=Math.round(bboxheight/custommapconfig.imgheight),adjwidth=Math.round(custommapconfig.imgwidth*ratiorealmap),adjheight=Math.round(custommapconfig.imgheight*ratiorealmap);customimageextent=referencetocenter?[centerwidth-adjwidth/2,centerheight-adjheight/2,centerwidth+adjwidth/2,centerheight+adjheight/2]:[customimageextent[0],customimageextent[1],customimageextent[0]+adjwidth,customimageextent[1]+adjheight]}return customimageextent}function initplaytreasurehunt(strings,cmid,treasurehuntid,playwithoutmoving,groupmode,lastattempttimestamp,lastroadtimestamp,gameupdatetime,tracking,user,custommapconfig){let customplayerconfig=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};setLoading(!0);let mapprojection="EPSG:3857",custombaselayer=null,geographictools=!0,defaultzoom=15,supportsTouch="ontouchstart"in window||navigator.msMaxTouchPoints;if(customplayerconfig&&customplayerconfig.defaultzoom&&(defaultzoom=customplayerconfig.defaultzoom),custommapconfig){if(custommapconfig.custombackgroundurl){var customimageextent=calculateCustomImageExtent(custommapconfig,mapprojection,!1);defaultzoom=5,custombaselayer=new _ol.default.layer.Image({title:custommapconfig.layername,name:custommapconfig.layername,type:custommapconfig.layertype,source:new _ol.default.source.ImageStatic({url:custommapconfig.custombackgroundurl,imageExtent:customimageextent}),opacity:1})}else if(custommapconfig.wmsurl){let options={type:custommapconfig.layertype,title:custommapconfig.layername,name:custommapconfig.layername};if("wms"===custommapconfig.layerservicetype?options.source=new _ol.default.source.TileWMS({url:custommapconfig.wmsurl,params:custommapconfig.wmsparams}):"tiled"===custommapconfig.layerservicetype?options.source=new _ol.default.source.XYZ({url:custommapconfig.wmsurl}):"arcgis"===custommapconfig.layerservicetype&&(options.source=new _ol.default.source.TileArcGISRest({url:custommapconfig.wmsurl})),custommapconfig.bbox[0]&&custommapconfig.bbox[1]&&custommapconfig.bbox[2]&&custommapconfig.bbox[3]){let customwmsextent=_ol.default.proj.transformExtent(custommapconfig.bbox,"EPSG:4326",mapprojection);options.extent=customwmsextent}custombaselayer=new _ol.default.layer.Tile(options),custombaselayer.set("name",custommapconfig.layername)}geographictools=custommapconfig.geographic}!1===geographictools&&(playwithoutmoving=!0,(0,_jquery.default)("#autolocate").hide());let interval,osmGeocoderXHR,parchmenturl=_url.default.imageUrl("success_mark","treasurehunt"),failureurl=_url.default.imageUrl("failure_mark","treasurehunt"),markerurl=_url.default.imageUrl("bootstrap/my_location_3","treasurehunt"),lastsuccessfulstage={},infomsgs=[],attemptshistory=[],changesinattemptshistory=!1,changesinlastsuccessfulstage=!1,changesinquestionstage=!1,fitmap=!1,roadfinished=!1,available=!0,qoaremoved=!1,osmTimer=0,text=new _ol.default.style.Text({textAlign:"center",scale:1.3,fill:new _ol.default.style.Fill({color:"#ffffff"}),stroke:new _ol.default.style.Stroke({color:"#000000",width:3.5})}),selectText=new _ol.default.style.Text({textAlign:"center",scale:1.4,fill:new _ol.default.style.Fill({color:"#fff"}),stroke:new _ol.default.style.Stroke({color:"#0097a7",width:3.5})}),defaultstageStyle=new _ol.default.style.Style({image:new _ol.default.style.Icon({anchor:[.5,1],opacity:1,scale:.5,src:parchmenturl}),text:text,zIndex:"Infinity"}),failstageStyle=new _ol.default.style.Style({image:new _ol.default.style.Icon({anchor:[.5,1],opacity:1,scale:.5,src:failureurl}),text:text,zIndex:"Infinity"}),defaultSelectstageStyle=new _ol.default.style.Style({image:new _ol.default.style.Icon({anchor:[.5,1],opacity:1,scale:.75,src:parchmenturl}),text:selectText,zIndex:"Infinity"}),failSelectstageStyle=new _ol.default.style.Style({image:new _ol.default.style.Icon({anchor:[.5,1],opacity:1,scale:.75,src:failureurl}),text:selectText,zIndex:"Infinity"}),accuracyFeatureStyle=new _ol.default.style.Style({fill:new _ol.default.style.Fill({color:[255,255,255,.3]}),stroke:new _ol.default.style.Stroke({color:[0,0,0,.5],width:1}),zIndex:-1}),layers=[],geoJSONFormat=new _ol.default.format.GeoJSON,attemptsource=new _ol.default.source.Vector({projection:"EPSG:3857"}),attemptslayer=new _ol.default.layer.Vector({source:attemptsource,style:attempt_style}),layersbase=[],layersoverlay=[];if(!custommapconfig||!1===custommapconfig.onlybase){let aeriallayer=new _ol.default.layer.Tile({visible:!1,source:new _ol.default.source.BingMaps({key:"AmC3DXdnK5sXC_Yp_pOLqssFSaplBbvN68jnwKTEM3CSn2t6G5PGTbYN3wzxE5BR",imagerySet:"AerialWithLabels",maxZoom:19})}),roadlayer=new _ol.default.layer.Tile({source:new _ol.default.source.OSM});aeriallayer.set("name",strings.aerialview),roadlayer.set("name",strings.roadview),layersbase=[aeriallayer,roadlayer]}custombaselayer&&("overlay"!=custommapconfig.layertype?layersbase.push(custombaselayer):layersoverlay.push(custombaselayer));let layergroup=new _ol.default.layer.Group({layers:layersbase});var overlay=_viewgpx.default.createCoordsOverlay("#mapplay","css/playerbootstrap/ol-popup.css",strings.pegmanlabel);let toplayer=null;layergroup.getLayers().forEach((layer=>{layer.setVisible(!1),toplayer=layer})),toplayer.setVisible(!0);let view=new _ol.default.View({center:[0,0],zoom:2,minZoom:2}),select=new _ol.default.interaction.Select({layers:[attemptslayer],style:select_style_function,filter:feature=>0!==feature.get("stageposition")}),accuracyFeature=new _ol.default.Feature;accuracyFeature.setProperties({name:"user_accuracy"}),accuracyFeature.setStyle(accuracyFeatureStyle);let positionFeature=new _ol.default.Feature;positionFeature.setProperties({name:"user_position"});let userPositionLayer=new _ol.default.layer.Vector({source:new _ol.default.source.Vector({features:[accuracyFeature,positionFeature]}),style:positionFeatureStyle}),markerFeature=new _ol.default.Feature;markerFeature.setGeometry(null),markerFeature.setStyle(markerFeatureStyle);let markerLayer=new _ol.default.layer.Vector({source:new _ol.default.source.Vector({features:[markerFeature]})});layers.push(layergroup),layers=layers.concat(layersoverlay),layers=layers.concat([attemptslayer,userPositionLayer,markerLayer]);let zoom=new _ol.default.control.Zoom({target:"navigation",className:"custom-zoom"}),map=new _ol.default.Map({layers:layers,overlays:[overlay],controls:[zoom],target:"mapplay",view:view,loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0});if(map.addInteraction(select),renew_source(!1,!0),interval=setInterval((()=>{renew_source(!1,!1)}),gameupdatetime),add_layergroup_to_list(layergroup),layersoverlay.forEach((overlay=>{add_layer_to_list(overlay)})),tracking&&user){let tracklayergroup=_viewgpx.default.addgpxlayer(map,cmid,treasurehuntid,strings,user,"trackgroup");tracklayergroup.set("name",tracklayergroup.get("title"));let tracklayer=tracklayergroup.getLayers().item(0),htmltitle=tracklayer.get("title");tracklayer.set("name",htmltitle),tracklayer.setVisible(!1),add_layer_to_list(tracklayer)}function attempt_style(feature){let stageposition=feature.get("stageposition");if(0===stageposition){let fill=new _ol.default.style.Fill({color:"rgba(0,0,0,0.1)"}),stroke=new _ol.default.style.Stroke({color:"#0097a7",width:2});return[new _ol.default.style.Style({image:new _ol.default.style.Circle({fill:fill,stroke:stroke,radius:5}),fill:fill,stroke:stroke,text:new _ol.default.style.Text({text:strings.startfromhere,textAlign:"center",fill:new _ol.default.style.Fill({color:"rgb(255,255,255)"}),stroke:new _ol.default.style.Stroke({color:"#0097a7",width:2}),overflow:!0,scale:2})})]}return feature.get("geometrysolved")?(defaultstageStyle.getText().setText(""+stageposition),[defaultstageStyle]):(failstageStyle.getText().setText(""+stageposition),[failstageStyle])}function select_style_function(feature){let stageposition=feature.get("stageposition");return feature.get("geometrysolved")?(defaultSelectstageStyle.getText().setText(""+stageposition),[defaultSelectstageStyle]):(failSelectstageStyle.getText().setText(""+stageposition),[failSelectstageStyle])}function validateposition(){playwithoutmoving&&!markerFeature.getGeometry()?toast(strings.nomarks):renew_source(!0,!1)}function autocentermap(){const position=geolocation.getPosition();fly_to(map,position)}function fly_to(map,point,extent){let view=map.getView();extent?view.fit(extent,{duration:700}):view.animate({zoom:defaultzoom,center:point,duration:700})}function renew_source(location,initialize,selectedanswerid,qrtext){let position,currentposition,coordinates,answerid;coordinates=playwithoutmoving?markerFeature.getGeometry():positionFeature.getGeometry(),coordinates&&(currentposition=geoJSONFormat.writeGeometryObject(coordinates,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})),selectedanswerid&&(setLoading(!0),answerid=selectedanswerid),location&&(position=currentposition,setLoading(!0)),_ajax.default.call([{methodname:"mod_treasurehunt_user_progress",args:{userprogress:{treasurehuntid:treasurehuntid,attempttimestamp:lastattempttimestamp,roadtimestamp:lastroadtimestamp,playwithoutmoving:playwithoutmoving,groupmode:groupmode,initialize:initialize,location:position,currentposition:tracking&&!playwithoutmoving?currentposition:void 0,selectedanswerid:answerid,qoaremoved:qoaremoved,qrtext:qrtext}}}])[0].done((response=>{if(qoaremoved=response.qoaremoved,roadfinished=response.roadfinished,available=response.available,setLoading(!1),(location||selectedanswerid)&&(null!==response.status&&available&&toast(response.status.msg),markerFeature.setGeometry(null)),playwithoutmoving!=response.playwithoutmoving&&((playwithoutmoving=response.playwithoutmoving)||markerFeature.setGeometry(null)),groupmode!=response.groupmode&&(groupmode=response.groupmode),lastattempttimestamp===response.attempttimestamp&&lastroadtimestamp===response.roadtimestamp&&!initialize&&available||(lastattempttimestamp=response.attempttimestamp,lastroadtimestamp=response.roadtimestamp,response.attempthistory.length>0&&(attemptshistory=response.attempthistory,changesinattemptshistory=!0),(response.attempts||response.firststagegeom)&&(attemptsource.clear(),response.firststagegeom&&attemptsource.addFeatures(geoJSONFormat.readFeatures(response.firststagegeom,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})),response.attempts.features.length>0&&attemptsource.addFeatures(geoJSONFormat.readFeatures(response.attempts,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}))),response.lastsuccessfulstage&&(lastsuccessfulstage=response.lastsuccessfulstage,changesinlastsuccessfulstage=!0,openModal("#cluepage"),(0,_jquery.default)("#validateqr").hide(),""!==lastsuccessfulstage.question?(changesinquestionstage=!0,(0,_jquery.default)("#validatelocation").hide()):lastsuccessfulstage.activitysolved?((0,_jquery.default)("#validatelocation").show(),response.qrexpected&&(0,_jquery.default)("#validateqr").show()):(0,_jquery.default)("#validatelocation").hide()),(response.firststagegeom||initialize)&&(fitmap=!0),set_lastsuccessfulstage(),fit_map_to_source(),set_question(),set_attempts_history()),response.infomsg.length>0){let body="";infomsgs.forEach((msg=>{body+="<p>"+msg+"</p>"})),response.infomsg.forEach((msg=>{infomsgs.push(msg),body+="<p>"+msg+"</p>"})),(0,_jquery.default)("#notificationsPopup .update-list").html(body),openModal("#notificationsPopup"),(0,_jquery.default)("#notificationsPopup").on("modal:close",(function(){openModal("#cluepage")}))}roadfinished||(0,_jquery.default)("#roadended").hide(),!roadfinished&&available||((0,_jquery.default)("#validatelocation").hide(),(0,_jquery.default)("#question_button").hide(),(0,_jquery.default)("#roadended").show(),markerFeature.setGeometry(null),playwithoutmoving=!1,clearInterval(interval),(0,_jquery.default)("#mapplay").css("opacity","0.8"))})).fail((error=>{(0,_jquery.default)("#errorPopup .play-modal-content").text(error.message),openModal("#errorPopup"),clearInterval(interval)}))}function fit_map_to_source(){if(fitmap){let features=attemptsource.getFeatures();1===features.length&&features[0].getGeometry()instanceof _ol.default.geom.Point?fly_to(map,features[0].getGeometry().getCoordinates()):fly_to(map,null,attemptsource.getExtent()),fitmap=!1}}function set_lastsuccessfulstage(){changesinlastsuccessfulstage&&(lastsuccessfulstage.clue=lastsuccessfulstage.clue.replace(/color/gm,"color-disabled"),(0,_jquery.default)("#lastsuccessfulstageclue").html(lastsuccessfulstage.clue),(0,_jquery.default)("#lastsuccessfulstagename").text(lastsuccessfulstage.name),(0,_jquery.default)("#lastsuccesfulstagepos").text(lastsuccessfulstage.position+" / "+lastsuccessfulstage.totalnumber),""!==lastsuccessfulstage.question?(0,_jquery.default)("#questionbutton").show():(0,_jquery.default)("#questionbutton").hide(),changesinlastsuccessfulstage=!1)}function set_question(){if(changesinquestionstage){lastsuccessfulstage.question=lastsuccessfulstage.question.replace(/color/gm,"color-disabled"),(0,_jquery.default)("#questionform").html("<legend>"+lastsuccessfulstage.question+"</legend>");let counter=1;_jquery.default.each(lastsuccessfulstage.answers,((key,answer)=>{let id="answer"+counter;answer.answertext=answer.answertext.replace(/color/gm,"color-disabled"),(0,_jquery.default)("#questionform").append(`<div class="form-check">\n                <input class="form-check-input" type="radio" name="answers" id="${id}" value="${answer.id}">\n                <label class="form-check-label" for="${id}">\n                  ${answer.answertext}\n                </label>\n            </div>`),counter++})),changesinquestionstage=!1}}function set_attempts_history(){if(changesinattemptshistory){let $historylist=(0,_jquery.default)("#historylist");$historylist.html(""),changesinattemptshistory=!1,0===attemptshistory.length?(0,_jquery.default)("<li>"+strings.noattempts+"</li>").appendTo($historylist):attemptshistory.forEach((attempt=>{(0,_jquery.default)("<li><span class='ui-btn-icon-left "+(attempt.penalty?"ui-icon-delete failedattempt":"ui-icon-check successfulattempt")+"' style='position:relative'></span>"+attempt.string+"</li>").appendTo($historylist)}))}}function add_layer_to_list(layer){let link=(0,_jquery.default)("<button>",{type:"button",class:"list-group-item list-group-item-action close-modal"}).click((()=>{layer.setVisible(!layer.getVisible())})),name=(0,_jquery.default)("<div>").append(_jquery.default.parseHTML(layer.get("name"))),checkboxContent=(0,_jquery.default)("<i>",{class:"fa fa-check-circle"+(layer.getVisible()?"":" unchecked")}),linkContent=(0,_jquery.default)("<div>",{class:"layer-item"}).append(name,checkboxContent);link.append(linkContent),layer.on("change:visible",(()=>{(0,_jquery.default)(checkboxContent).toggleClass("unchecked")})),(0,_jquery.default)("#layerslist").prepend(link)}function add_layergroup_to_list(layergroup){layergroup.getLayers().forEach((layer=>{let link=(0,_jquery.default)("<button>",{type:"button",class:"list-group-item list-group-item-action close-modal"}).click((()=>{layergroup.getLayers().forEach((l=>{l===layer?l.setVisible(!0):l.setVisible(!1)}))})),checkboxContent=(0,_jquery.default)("<i>",{class:"fa fa-check-circle"+(layer.getVisible()?"":" unchecked")}),linkContent=(0,_jquery.default)("<div>",{text:layer.get("name"),class:"layer-item "}).append(checkboxContent);link.append(linkContent),layer.on("change:visible",(()=>{(0,_jquery.default)(checkboxContent).toggleClass("unchecked")})),(0,_jquery.default)("#layerslist").prepend(link)}))}let geolocation=new _ol.default.Geolocation({projection:view.getProjection(),trackingOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:1e4}});geolocation.on("change:position",(()=>{let coordinates=geolocation.getPosition();positionFeature.setGeometry(coordinates?new _ol.default.geom.Point(coordinates):null),geolocation.get("center")&&(fly_to(map,coordinates),geolocation.setProperties({center:!1})),geolocation.get("validate_location")&&(renew_source(!0,!1),geolocation.setProperties({validate_location:!1}))})),geolocation.on("change:accuracyGeometry",(()=>{accuracyFeature.setGeometry(geolocation.getAccuracyGeometry())}));let trackinggeolocationwarndispatched=!1;function toast(msg){const toast=(0,_jquery.default)(`<div class='play-toast slide-in-bottom'>${msg}</div>`);toast.appendTo((0,_jquery.default)(".play-toast-container")),setTimeout((()=>toast.addClass("slide-out-top")),3e3),setTimeout((()=>toast.remove()),3500)}function openModal(id){closeModal();const modal=(0,_jquery.default)(id);modal.addClass("active"),(0,_jquery.default)(`${id} .modal-mask`).addClass("active dismissible"),modal.trigger("modal:open")}function closeModal(){const modals=(0,_jquery.default)(".play-modal.active");modals.removeClass("active"),(0,_jquery.default)(".modal-mask").removeClass("active dismissible"),modals.each(((index,modal)=>{(0,_jquery.default)(modal).trigger("modal:close")}))}function get_block_text(title,body){return`<div class="card">\n          <div class="card-body">\n            <h5 class="card-title">${title}</h5>\n            <h6 class="card-subtitle text-muted">${body}</h6>\n          </div>\n      </div>`}function closeSidePanel(id){(0,_jquery.default)(id).removeClass("active"),(0,_jquery.default)(".sidebar-mask").removeClass("active dismissible")}function setLoading(loading){loading?(0,_jquery.default)(".global-loader").addClass("active"):(0,_jquery.default)(".global-loader").removeClass("active")}function markerFeatureStyle(){return[new _ol.default.style.Style({image:new _ol.default.style.Icon({anchor:[.5,.9],opacity:1,scale:1,src:markerurl})}),positionFeatureStyle(markerFeature)]}function positionFeatureStyle(feature){let targetfeature=attemptsource.getFeatures()[0],rotation=0;return rotation=targetfeature?calculateHeading(feature.getGeometry(),targetfeature.getGeometry()):0,new _ol.default.style.Style({fill:new _ol.default.style.Fill({color:"rgba(0, 0, 255, 0.2)"}),image:new _ol.default.style.Icon({src:"./pix/bootstrap/geolocation_marker_heading.png",rotateWithView:!0,rotation:rotation})})}function calculateHeading(start,end){let closestPoint=end.getClosestPoint(start.getCoordinates()),deltaX=closestPoint[0]-start.getCoordinates()[0],deltaY=closestPoint[1]-start.getCoordinates()[1],heading=Math.atan2(deltaY,deltaX);return heading<0&&(heading+=2*Math.PI),-heading+Math.PI/2}function qrReaded(value){closeModal(),toast("QR code readed: "+value),renew_source(!1,!1,null,value)}function qrReport(message){"string"==typeof message?(0,_jquery.default)("#errorQR").text(message):(null!==message.cameras[message.camera].name&&(0,_jquery.default)("#errorQR").text(message.cameras[message.camera].name),message.cameras.length>1?(0,_jquery.default)("#nextcamera").show():(0,_jquery.default)("#nextcamera").hide())}geolocation.on("error",(error=>{geolocation.setProperties({user_denied:!0}),toast(error.message),error.code==error.PERMISSION_DENIED&&tracking&&!playwithoutmoving&&0==trackinggeolocationwarndispatched&&setTimeout((()=>{openModal("#geolocationPopup"),trackinggeolocationwarndispatched=!0}),500)})),geolocation.setTracking(tracking),supportsTouch||map.on("pointermove",(evt=>{if(evt.dragging)return;const pixel=map.getEventPixel(evt.originalEvent);let hit=!1;map.forEachFeatureAtPixel(pixel,(feature=>{feature.getGeometry()instanceof _ol.default.geom.MultiPolygon||(hit=!0)}),{layerFilter:layer=>layer===attemptslayer}),map.getTargetElement().style.cursor=hit?"pointer":"crosshair"})),select.on("select",(features=>{if(1===features.selected.length){let stagename=features.selected[0].get("name"),stageclue=features.selected[0].get("clue"),info=features.selected[0].get("info"),body="",title="";info&&(body="<p>"+info+"</p>"),features.selected[0].get("geometrysolved")?stagename&&stageclue?(title=strings.stageovercome,body+=get_block_text(strings.stagename,stagename),body+=get_block_text(strings.stageclue,stageclue)):title=strings.discoveredlocation:title=strings.failedlocation,(0,_jquery.default)("#infoStagePopup .title").text(title),(0,_jquery.default)("#infoStagePopup .play-modal-content").html(body),openModal("#infoStagePopup")}})),map.on("click",(evt=>{let hasFeature=!1;if(map.forEachFeatureAtPixel(map.getEventPixel(evt.originalEvent),(feature=>{if(0===feature.get("stageposition")||"user_position"===feature.get("name")||"user_accuracy"===feature.get("name"))return!1;hasFeature=!0})),playwithoutmoving&&!hasFeature){let coordinates=map.getEventCoordinate(evt.originalEvent);markerFeature.setGeometry(coordinates?new _ol.default.geom.Point(coordinates):null),(null===custommapconfig||custommapconfig.geographic)&&overlay.setPosition(evt.coordinate)}})),(0,_jquery.default)("#searchInput").on("input",(ev=>{osmGeocoderXHR&&osmGeocoderXHR.abort(),osmTimer&&clearTimeout(osmTimer);const $searchContainer=(0,_jquery.default)("#searchsResults"),value=ev.target.value;$searchContainer.html(""),value&&value.length>2&&((0,_jquery.default)(".search-loading").addClass("active"),osmTimer=setTimeout((()=>{osmGeocoderXHR=_osmGeocoder.default.search(value).done((resp=>{(0,_jquery.default)(".search-loading").removeClass("active"),0===resp.length?$searchContainer.html("<li class='list-group-item'>"+strings.noresults+"</li>"):_jquery.default.each(resp,((i,place)=>{let link=(0,_jquery.default)("<button>",{type:"button",class:"list-group-item list-group-item-action"}).appendTo($searchContainer).click((()=>{let extent=[];extent[0]=parseFloat(place.boundingbox[2]),extent[1]=parseFloat(place.boundingbox[0]),extent[2]=parseFloat(place.boundingbox[3]),extent[3]=parseFloat(place.boundingbox[1]),extent=_ol.default.proj.transformExtent(extent,"EPSG:4326","EPSG:3857"),fly_to(map,null,extent),closeSidePanel("#searchpanel")})),linkContent=(0,_jquery.default)("<div>",{text:place.display_name,class:"search-option"}).append((0,_jquery.default)("<i class='fa fa-chevron-circle-right'>"));link.append(linkContent)}))})).fail((()=>{})).always((()=>{osmGeocoderXHR=null}))}),400))})),(0,_jquery.default)("#infoStagePopup").on("modal:close",(()=>{select.getFeatures().clear()})),(0,_jquery.default)("#acceptupdates").on("click",(()=>{infomsgs=[]})),(0,_jquery.default)("#qrpage").on("modal:open",(()=>{_webqr.default.loadQR(qrReaded,qrReport)})),(0,_jquery.default)("#qrpage").on("modal:close",(()=>{_webqr.default.unloadQR(qrReport)})),(0,_jquery.default)("#nextcamera").on("click",(()=>{let detectedCameras=_webqr.default.getDetectedCameras();if(null!==detectedCameras){toast("Give access to:"+detectedCameras[_webqr.default.getnextwebCam()].name)}_webqr.default.setnextwebcam(qrReport)})),(0,_jquery.default)(window).on("resize",(()=>{map.updateSize()})),geographictools&&(0,_jquery.default)("#autolocate").on("click",(()=>{geolocation.get("user_denied")?openModal("#geolocationPopup"):autocentermap()})),(0,_jquery.default)("#infopanel").on("sidebar:close",(()=>{select.getFeatures().clear()})),(0,_jquery.default)("#sendLocation").on("click",(()=>{validateposition()})),(0,_jquery.default)("#sendAnswer").on("click",(event=>{let selected=(0,_jquery.default)("#questionform input[type='radio']:checked");available?0===selected.length?(event.preventDefault(),toast(strings.noanswerselected)):renew_source(!1,!1,selected.val()):(event.preventDefault(),toast(strings.timeexceeded))})),(0,_jquery.default)("#validatelocation").on("click",(event=>roadfinished?(event.preventDefault(),void toast(strings.huntcompleted)):available?""!==lastsuccessfulstage.question?(event.preventDefault(),toast(strings.answerwarning),void openModal("#cluepage")):lastsuccessfulstage.activitysolved?void 0:(event.preventDefault(),toast(strings.activitytoendwarning),void openModal("#cluepage")):(event.preventDefault(),void toast(strings.timeexceeded)))),(0,_jquery.default)(document).on("click",'*[data-rel="sidebar"]',(e=>{const target=e.currentTarget,sidebar=(0,_jquery.default)(target.dataset.ref);sidebar.trigger("sidebar:open"),sidebar.addClass("active"),null!==target.dataset.dismissible&&(0,_jquery.default)(".sidebar-mask").addClass("active dismissible")})),(0,_jquery.default)(document).on("click",".close-sidebar, .sidebar-mask",(()=>{const sidebars=(0,_jquery.default)(".sidebar.active");sidebars.trigger("sidebar:close"),sidebars.removeClass("active"),(0,_jquery.default)(".sidebar-mask").removeClass("active dismissible")})),(0,_jquery.default)(document).on("click",'*[data-rel="modal"]',(e=>{closeModal();const target=e.currentTarget,modal=(0,_jquery.default)(target.dataset.ref);modal.trigger("modal:open"),modal.addClass("active"),(0,_jquery.default)(target.dataset.ref+" .modal-mask").addClass("active"),null!==target.dataset.dismissible&&(0,_jquery.default)(target.dataset.ref+" .modal-mask").addClass("dismissible")})),(0,_jquery.default)(document).on("click",".close-modal, .modal-mask.dismissible",(()=>{closeModal()}))}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_url=_interopRequireDefault(_url),_ol=_interopRequireDefault(_ol),_ajax=_interopRequireDefault(_ajax),_osmGeocoder=_interopRequireDefault(_osmGeocoder),_viewgpx=_interopRequireDefault(_viewgpx),_webqr=_interopRequireDefault(_webqr);var _default={playtreasurehunt:function(cmid,treasurehuntid,playwithoutmoving,groupmode,lastattempttimestamp,lastroadtimestamp,gameupdatetime,tracking,user,custommapconfig,customplayerconfig){void 0===customplayerconfig&&(customplayerconfig={});let terms=["stageovercome","failedlocation","stage","stagename","stageclue","question","noanswerselected","timeexceeded","searching","continue","noattempts","aerialview","roadview","noresults","startfromhere","nomarks","updates","activitytoendwarning","huntcompleted","discoveredlocation","answerwarning","error","pegmanlabel"],stringsqueried=terms.map((term=>({key:term,component:"treasurehunt"})));(0,_str.getStrings)(stringsqueried).then((strings=>{let i18n=[];for(let i=0;i<terms.length;i++)i18n[terms[i]]=strings[i];if(void 0!==custommapconfig&&custommapconfig&&custommapconfig.custombackgroundurl){let img=new Image;img.addEventListener("load",(function(){custommapconfig.imgwidth=this.naturalWidth,custommapconfig.imgheight=this.naturalHeight,initplaytreasurehunt(i18n,cmid,treasurehuntid,playwithoutmoving,groupmode,lastattempttimestamp,lastroadtimestamp,gameupdatetime,tracking,user,custommapconfig,customplayerconfig)})),img.src=custommapconfig.custombackgroundurl}else initplaytreasurehunt(i18n,cmid,treasurehuntid,playwithoutmoving,groupmode,lastattempttimestamp,lastroadtimestamp,gameupdatetime,tracking,user,custommapconfig,customplayerconfig)}))}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=play_bootstrap.min.js.map